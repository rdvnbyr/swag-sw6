(()=>{"use strict";let t="loader",e={BEFORE:"before",INNER:"inner"};class n{constructor(t,n=e.BEFORE){this.parent=t instanceof Element?t:document.body.querySelector(t),this.position=n}create(){if(!this.exists()){if(this.position===e.INNER){this.parent.innerHTML=n.getTemplate();return}this.parent.insertAdjacentHTML(this._getPosition(),n.getTemplate())}}remove(){this.parent.querySelectorAll(`.${t}`).forEach(t=>t.remove())}exists(){return this.parent.querySelectorAll(`.${t}`).length>0}_getPosition(){return this.position===e.BEFORE?"afterbegin":"beforeend"}static getTemplate(){return`<div class="${t}" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>`}static SELECTOR_CLASS(){return t}}let i="element-loader-backdrop";class a extends n{static create(t){t.classList.add("has-element-loader"),a.exists(t)||(a.appendLoader(t),setTimeout(()=>{let e=t.querySelector(`.${i}`);e&&e.classList.add("element-loader-backdrop-open")},1))}static remove(t){t.classList.remove("has-element-loader");let e=t.querySelector(`.${i}`);e&&e.remove()}static exists(t){return t.querySelectorAll(`.${i}`).length>0}static getTemplate(){return`
        <div class="${i}">
            <div class="loader" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
        `}static appendLoader(t){t.insertAdjacentHTML("beforeend",a.getTemplate())}}let o=window.PluginBaseClass;class s extends o{static #t=this.options={libraryUrl:"https://static-eu.payments-amazon.com/checkout.js",amazonPayPluginVersion:"10.2.0",errorElementId:"swag-amazon-pay-button-error",loadingElementId:"swag-amazon-pay-loading-indicator",createCheckoutSessionConfig:{payloadJSON:"",signature:"",publicKeyId:""},type:"default",buttonConfig:{merchantId:"",sandbox:!1,ledgerCurrency:"",checkoutLanguage:"",productType:"",placement:"",buttonColor:"Gold"}};init(){this._initializeAmazonScript(),this._initializeEventHandler()}getAmazonPayObject(){return window.amazon.Pay}setLoading(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.$emitter.publish("swagAmazonPay_setLoading",{loading:t});let e=document.getElementById(this.options.loadingElementId);this.el.hidden=!0,t?(e.hidden=!1,a.create(e)):(e.hidden=!0,a.remove(e))}displayError(){this.$emitter.publish("swagAmazonPay_displayError"),document.getElementById(this.options.errorElementId).hidden=!1,this.el.hidden=!0}onInsecureConnectionButtonInteraction(){document.querySelectorAll(".swag-amazon-pay-button-container").forEach(t=>{t.style.visibility="hidden"}),document.querySelectorAll(".swag-amazon-pay-button-error").forEach(t=>{t.classList.contains("connection-is-insecure")&&(t.hidden=!1)})}_initializeAmazonScript(){this.$emitter.publish("swagAmazonPay_beforeLoadAmazonPayScript"),window.amazonPayOnLoadCallbacks=window.amazonPayOnLoadCallbacks||[],window.amazonPayOnLoadCallbacks.push(this.renderButton.bind(this));let t="swag-amazon-pay-js-"+this.options.buttonConfig.merchantId;if(document.getElementById(t)){void 0!==window.amazon&&this.executeAmazonPayOnLoadCallbacks();return}this.scriptElement=document.createElement("script"),this.scriptElement.type="text/javascript",this.scriptElement.src=this.options.libraryUrl,this.scriptElement.id=t,this.scriptElement.addEventListener("load",this.executeAmazonPayOnLoadCallbacks.bind(this),!1),document.head.appendChild(this.scriptElement)}executeAmazonPayOnLoadCallbacks(){window.amazonPayOnLoadCallbacksExecuting&&setTimeout(this.executeAmazonPayOnLoadCallbacks,500),window.amazonPayOnLoadCallbacksExecuting=!0;try{window.amazonPayOnLoadCallbacks&&window.amazonPayOnLoadCallbacks.forEach((t,e)=>{t(),delete window.amazonPayOnLoadCallbacks[e]})}catch(t){console.error(t)}window.amazonPayOnLoadCallbacksExecuting=!1;let t="swag-amazon-pay-js-"+this.options.buttonConfig.merchantId,e=document.getElementById(t);e&&e.removeEventListener("load",this.executeAmazonPayOnLoadCallbacks),this.$emitter.publish("swagAmazonPay_amazonPayScriptLoaded")}_initializeEventHandler(){let t=this;document.querySelectorAll(".swag-amazon-pay-button-tooltip-overlay").forEach(e=>{e.classList.contains("connection-is-insecure")&&e.addEventListener("click",t.onInsecureConnectionButtonInteraction.bind(t))})}renderButton(){let t=this.getAmazonPayObject().renderButton(`#${this.el.id}`,this.options.buttonConfig);this._addAmazonPayButtonOnClickHandler(t),"product-box"===this.options.type&&this.addListingAddCartAction()}beforeInitCheckout(){return new Promise(t=>{t()})}initCheckout(t){this.$emitter.publish("swagAmazonPay_amazonPayCheckoutInitiated"),t.initCheckout({createCheckoutSessionConfig:this.options.createCheckoutSessionConfig})}_addAmazonPayButtonOnClickHandler(t){t.onClick(()=>(this.$emitter.publish("swagAmazonPay_amazonPayButtonClicked"),this.setLoading(),this.beforeInitCheckout().then(()=>{this.initCheckout(t),setTimeout(()=>{this.setLoading(!1)},3e3)})))}addListingAddCartAction(){this.$emitter.publish("swagAmazonPayButton_beforeListingAddProductToCart",{plugin:this});let t=this.el.closest("form");if(!t)return;let e=t.action,n=new FormData(t);this.beforeInitCheckout=()=>new Promise(t=>{fetch(e,{method:"POST",body:n}).then(e=>{if(!e.ok)throw Error("Network response was not ok.");t(),this.$emitter.publish("swagAmazonPayButton_afterListingAddProductToCart",{plugin:this})}).catch(t=>{console.error(t)})})}}let r=window.PluginBaseClass;class c extends r{static #t=this.options={libraryUrl:"https://static-eu.payments-amazon.com/checkout.js",errorElementId:"swag-amazon-pay-button-error",loadingElementId:"swag-amazon-pay-loading-indicator",buttonConfig:{merchantId:"",sandbox:!1,ledgerCurrency:"",checkoutLanguage:"",productType:"",placement:"",signInConfig:{payloadJSON:"",signature:"",publicKeyId:""},buttonColor:"Gold"}};init(){this._initializeAmazonScript(),this._initializeEventHandler()}getAmazonPayObject(){return window.amazon.Pay}setLoading(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.$emitter.publish("swagAmazonPay_setLoading",{loading:t});let e=document.getElementById(this.options.loadingElementId);this.el.hidden=!0,t?(e.hidden=!1,a.create(e)):(e.hidden=!0,a.remove(e))}displayError(){this.$emitter.publish("swagAmazonPay_displayError"),document.getElementById(this.options.errorElementId).hidden=!1,this.el.hidden=!0}onInsecureConnectionButtonInteraction(){document.querySelectorAll(".swag-amazon-pay-button-container").forEach(t=>{t.style.visibility="hidden"}),document.querySelectorAll(".swag-amazon-pay-button-error").forEach(t=>{t.classList.contains("connection-is-insecure")&&(t.hidden=!1)})}_initializeAmazonScript(){this.$emitter.publish("swagAmazonPay_beforeLoadAmazonPayScript"),void 0!==this.scriptElement&&this._onLoadAmazonPayScript(),this.scriptElement=document.createElement("script"),this.scriptElement.type="text/javascript",this.scriptElement.src=this.options.libraryUrl,this.scriptElement.addEventListener("load",this._onLoadAmazonPayScript.bind(this),!1),document.head.appendChild(this.scriptElement)}_initializeEventHandler(){document.querySelectorAll(".swag-amazon-pay-button-tooltip-overlay").forEach(t=>{t.classList.contains("connection-is-insecure")&&t.addEventListener("click",this.onInsecureConnectionButtonInteraction.bind(this))})}_onLoadAmazonPayScript(){this.getAmazonPayObject().renderButton(`#${this.el.id}`,this.options.buttonConfig),this.scriptElement.removeEventListener("load",this._onLoadAmazonPayScript),this.$emitter.publish("swagAmazonPay_amazonPayScriptLoaded")}}class d{static formToJson(t){let e=new FormData(t),n={};return e.forEach((t,e)=>{n[e]?(Array.isArray(n[e])||(n[e]=[n[e]]),n[e].push(t)):n[e]=t}),n}}let l=window.PluginBaseClass;class h extends l{static #t=this.options={addLineItemUrl:"",addLineItemToken:""};init(){this.buttonPlugin=window.PluginManager.getPluginInstances("AmazonPayButton")[0],this.buttonPlugin.beforeInitCheckout=this._getAddProductPromise.bind(this)}_getAddProductPromise(){this.$emitter.publish("swagAmazonPayProductDetail_beforeAddProductToCart");let t=this._formatLineItems();return t._csrf_token=this.options.addLineItemToken,new Promise(e=>{fetch(this.options.addLineItemUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(t=>t.text()).then(t=>{e(),this.$emitter.publish("swagAmazonPayProductDetail_afterAddProductToCart")})})}_formatLineItems(){let t=d.formToJson(this.el.closest("form")),e={};return Object.keys(t).forEach(n=>{let i=n.match(/lineItems\[(.+)]\[(.+)]/);"redirectTo"!==n&&i&&3===i.length&&(e[i[1]]?e[i[1]][i[2]]=t[i[0]]:e[i[1]]={[i[2]]:t[i[0]]})}),{lineItems:e}}}let m=window.PluginBaseClass;class u extends m{static #t=this.options={checkoutSessionId:"",libraryUrl:"https://static-eu.payments-amazon.com/checkout.js",changeShippingButtonSelector:"#swag-amazon-pay-change-shipping",changePaymentButtonSelector:"#swag-amazon-pay-change-amazon-payment"};init(){this._initializeAmazonScript()}_initializeAmazonScript(){void 0!==this.scriptElement&&this._onLoadAmazonPayScript(),this.$emitter.publish("swagAmazonPay_beforeLoadAmazonPayScript"),this.scriptElement=document.createElement("script"),this.scriptElement.type="text/javascript",this.scriptElement.src=this.options.libraryUrl,this.scriptElement.addEventListener("load",this._onLoadAmazonPayScript.bind(this),!1),document.head.appendChild(this.scriptElement)}_onLoadAmazonPayScript(){window.amazon.Pay.bindChangeAction(this.options.changeShippingButtonSelector,{amazonCheckoutSessionId:this.options.checkoutSessionId,changeAction:"changeAddress"}),document.querySelector(this.options.changePaymentButtonSelector)&&window.amazon.Pay.bindChangeAction(this.options.changePaymentButtonSelector,{amazonCheckoutSessionId:this.options.checkoutSessionId,changeAction:"changePayment"})}}let p=window.PluginBaseClass,y=window.PluginBaseClass;class g extends y{static #t=this.options={libraryUrl:"https://static-eu.payments-amazon.com/checkout.js",merchantId:"",ledgerCurrency:"EUR",sandbox:!0,productType:"PayAndShip",createCheckoutSessionConfig:{payloadJSON:"",signature:"",publicKeyId:""}};init(){a.create(this.el),this._initializeAmazonScript()}_initializeAmazonScript(){this.$emitter.publish("swagAmazonPay_beforeLoadAmazonPayScript"),void 0!==this.scriptElement&&this._onLoadAmazonPayScript(),this.scriptElement=document.createElement("script"),this.scriptElement.type="text/javascript",this.scriptElement.src=this.options.libraryUrl,this.scriptElement.addEventListener("load",this._onLoadAmazonPayScript.bind(this),!1),document.head.appendChild(this.scriptElement)}_onLoadAmazonPayScript(){window.amazon.Pay.initCheckout({merchantId:this.options.merchantId,ledgerCurrency:this.options.ledgerCurrency,sandbox:!!this.options.sandbox,productType:this.options.productType,placement:"Other",createCheckoutSessionConfig:this.options.createCheckoutSessionConfig})}}let z=window.PluginManager;z.register("AmazonPayButton",s,"[data-amazon-pay-button]"),z.register("AmazonLoginButton",c,"[data-amazon-login-button]"),z.register("AmazonPayButtonProductDetail",h,"[data-amazon-pay-button-product-detail]"),z.register("AmazonPayConfirmPage",u,"[data-amazon-pay-confirm-page]"),z.register("AmazonLoginRegistrationPage",class extends p{init(){this._updateFormHandling(),this._setEmailReadOnly()}_updateFormHandling(){let t=this.el.dataset.amazonRegistrationUrl;this.el.querySelector("form").action=t}_setEmailReadOnly(){this.el.querySelector('input[name="email"]').readOnly=!0}},"[data-amazon-registration-url]"),z.register("AmazonPayPurePaymentMethodPlugin",g,'[data-amazon-pay-pure-payment-method="true"]')})();