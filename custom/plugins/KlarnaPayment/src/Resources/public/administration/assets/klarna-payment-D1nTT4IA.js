const{Application:h}=Shopware,c=Shopware.Classes.ApiService;class _ extends c{constructor(t,a,n="klarna_payment"){super(t,a,n)}validateCredentials(t,a){const n={...t,endpoint:a};return this.httpClient.post(`_action/${this.getApiBasePath()}/validate-credentials`,n,{headers:this.getBasicHeaders()}).then(r=>c.handleResponse(r))}getEuApiRegionKey(){return this.getApiRegionKey("eu")}getUsApiRegionKey(){return this.getApiRegionKey("us")}getApiRegionKey(t){return this.httpClient.post(`_action/${this.getApiBasePath()}/fetch-${t}-api-region-key`,{},{headers:this.getBasicHeaders()}).then(a=>c.handleResponse(a))}}h.addServiceProvider("KlarnaPaymentConfigurationService",e=>{const t=h.getContainer("init");return new _(t.httpClient,e.loginService)});const{Application:g}=Shopware,o=Shopware.Classes.ApiService;class A extends o{constructor(t,a,n="klarna_payment"){super(t,a,n)}fetchOrderData(t,a,n){return this.httpClient.post(`_action/${this.getApiBasePath()}/fetch_order`,{order_id:t,klarna_order_id:a,salesChannel:n},{headers:this.getBasicHeaders()}).then(r=>o.handleResponse(r))}captureOrder(t){return this.httpClient.post(`_action/${this.getApiBasePath()}/capture_order`,t,{headers:this.getBasicHeaders()}).then(a=>o.handleResponse(a))}refundOrder(t){return this.httpClient.post(`_action/${this.getApiBasePath()}/refund_order`,t,{headers:this.getBasicHeaders()}).then(a=>o.handleResponse(a))}cancelPayment(t,a,n,r){const i=this.getBasicHeaders();return this.httpClient.post(`_action/${this.getApiBasePath()}/cancel_payment`,{orderTransactionId:t,order_id:a,klarna_order_id:n,salesChannel:r},{headers:i}).then(s=>o.handleResponse(s))}releaseRemainingAuthorization(t,a,n){const r=this.getBasicHeaders();return this.httpClient.post(`_action/${this.getApiBasePath()}/release_remaining_authorization`,{order_id:t,klarna_order_id:a,salesChannel:n},{headers:r}).then(i=>o.handleResponse(i))}extendAuthorization(t,a){const n=this.getBasicHeaders();return this.httpClient.post(`_action/${this.getApiBasePath()}/extend_authorization`,{order_id:t,klarna_order_id:a},{headers:n}).then(r=>o.handleResponse(r))}}g.addServiceProvider("KlarnaPaymentOrderService",e=>{const t=g.getContainer("init");return new A(t.httpClient,e.loginService)});const{Application:f}=Shopware,y=Shopware.Classes.ApiService;class p extends y{constructor(t,a,n="klarna_payment"){super(t,a,n)}updateOrder(t,a){return this.httpClient.post(`_action/${this.getApiBasePath()}/update_order`,{orderId:t},{headers:this.getBasicHeaders(p.getVersionHeader(a))}).then(n=>y.handleResponse(n))}}f.addServiceProvider("KlarnaPaymentOrderUpdateService",e=>{const t=f.getContainer("init");return new p(t.httpClient,e.loginService)});const{Application:k}=Shopware,m=Shopware.Classes.ApiService;class M extends m{constructor(t,a,n="klarna_payment"){super(t,a,n)}finalizeInstallation(t){return this.httpClient.post(`_action/${this.getApiBasePath()}/finalize_installation`,{tableData:JSON.stringify(t)},{headers:this.getBasicHeaders()}).then(a=>m.handleResponse(a))}fetchData(){return this.httpClient.get(`_action/${this.getApiBasePath()}/fetch_data`,{headers:this.getBasicHeaders()}).then(t=>m.handleResponse(t))}}k.addServiceProvider("KlarnaPaymentWizardService",e=>{const t=k.getContainer("init");return new M(t.httpClient,e.loginService)});const x=`{% block klarna_payment_plugin_icon %} <img :src="assetFilter('/klarnapayment/administration/static/plugin.png')"> {% endblock %}`,{Component:D,Filter:E}=Shopware;D.register("klarna-payment-plugin-icon",{template:x,computed:{assetFilter(){return E.getByName("asset")}}});const{Component:O}=Shopware,{Criteria:b}=Shopware.Data;O.extend("klarna-select-order-state","sw-entity-single-select",{props:{criteria:{type:Object,required:!1,default(){const e=new b(1,100);return e.addFilter(b.equals("stateMachine.technicalName","order.state")),e}}}});const{Component:z}=Shopware,{Criteria:w}=Shopware.Data;z.extend("klarna-select-delivery-state","sw-entity-single-select",{props:{criteria:{type:Object,required:!1,default(){const e=new w(1,100);return e.addFilter(w.equals("stateMachine.technicalName","order_delivery.state")),e}}}});const R=`{% block sw_multi_select %} <div> <div class="klarna-payment-settings-kp__info"> <ul> <li> <h3>{{ $tc('klarna-payment-configuration.settingsForm.klarnaPayments.payLater.title') }}</h3> <img src="https://x.klarnacdn.net/payment-method/assets/badges/generic/klarna.png" :title="$tc('klarna-payment-configuration.settingsForm.klarnaPayments.payLater.title')" :alt="$tc('klarna-payment-configuration.settingsForm.klarnaPayments.payLater.title')"/> <p>{{ $tc('klarna-payment-configuration.settingsForm.klarnaPayments.payLater.description') }}</p> </li> <li> <h3>{{ $tc('klarna-payment-configuration.settingsForm.klarnaPayments.sliceIt.title') }}</h3> <img src="https://x.klarnacdn.net/payment-method/assets/badges/generic/klarna.png" :title="$tc('klarna-payment-configuration.settingsForm.klarnaPayments.sliceIt.title')" :alt="$tc('klarna-payment-configuration.settingsForm.klarnaPayments.sliceIt.title')"/> <p>{{ $tc('klarna-payment-configuration.settingsForm.klarnaPayments.sliceIt.description') }}</p> </li> <li> <h3>{{ $tc('klarna-payment-configuration.settingsForm.klarnaPayments.payNow.title') }}</h3> <img src="https://x.klarnacdn.net/payment-method/assets/badges/generic/klarna.png" :title="$tc('klarna-payment-configuration.settingsForm.klarnaPayments.payNow.title')" :alt="$tc('klarna-payment-configuration.settingsForm.klarnaPayments.payNow.title')"/> <p>{{ $tc('klarna-payment-configuration.settingsForm.klarnaPayments.payNow.description') }}</p> <p><mt-icon name="regular-info-circle" small color="#3498db"/> {{ $tc('klarna-payment-configuration.settingsForm.klarnaPayments.payNow.additional') }}</p> </li> </ul> </div> {% parent() %} </div> {% endblock %}`,{Component:P}=Shopware;P.extend("klarna-select-payment-codes","sw-multi-select",{template:R});const{Component:T}=Shopware,{Criteria:F}=Shopware.Data;T.extend("klarna-select-salutation","sw-entity-single-select",{props:{criteria:{type:Object,required:!1,default(){return new F(1,100)}}}});const K=`{% block klarna_switch_field %} {# v-on="$listeners" needed becaues vue/compat removes them from $attrs #} {# New mt-switch component #} <mt-switch v-if="useMeteorComponent" v-bind="$attrs" :bordered="true" :checked="checkedValue" @change="onChangeHandler" > <slot></slot> </mt-switch> {# v-on="$listeners" needed becaues vue/compat removes them from $attrs #} {# Deprecated component #} {# TODO - check #} <sw-switch-field-deprecated v-else v-bind="$attrs" :bordered="true" :value="value" @update:value="onChangeHandler" > <slot></slot> </sw-switch-field-deprecated> {% block klarna_disable_address_validation_confirm_modal %} <sw-confirm-modal v-if="showDisableAddressValidationModal" class="klarna-disable-address-validation-modal" :title="$tc('klarna-payment-configuration.settingsForm.apiConfiguration.modal.title')" :text="$tc('klarna-payment-configuration.settingsForm.apiConfiguration.modal.text')" @confirm="onConfirmDisableAddressValidation" @close="onCloseDisableAddressValidationModal" @cancel="onCloseDisableAddressValidationModal" /> {% endblock %} {% endblock %}`,{Component:I}=Shopware;I.register("klarna-disable-address-validation-field",{template:K,compatConfig:Shopware.compatConfig,emits:["update:value"],props:{value:{type:Boolean,required:!1},checked:{type:Boolean,required:!1}},computed:{checkedValue(){return typeof this.checked=="boolean"?this.checked:this.value},useMeteorComponent(){return Shopware.Feature.isActive("v6.7.0.0")?!0:(Shopware.Utils.debug.warn("sw-switch-field",'The old usage of "sw-switch-field" is deprecated and will be removed in v6.7.0.0. Please use "mt-switch" instead.'),!1)}},methods:{onChangeHandler(e){e&&(this.showDisableAddressValidationModal=!0,setTimeout(()=>{let t=document.querySelector(".klarna-disable-address-validation-modal .sw-confirm-modal__text");t.innerHTML=t.innerHTML+" <a href='https://www.klarna.com/international/merchant-protection-program/' target='_blank'>Merchant Protection Program</a>."},100)),this.$emit("update:value",e)},onCloseDisableAddressValidationModal(){this.showDisableAddressValidationModal=!1,this.$emit("update:value",!1)},onConfirmDisableAddressValidation(){this.$emit("update:value",!0),this.showDisableAddressValidationModal=!1}},data(){return{showDisableAddressValidationModal:!1}}});const B=`{% block klarna_payment_settings %} <sw-page class="klarna-payment"> {% block klarna_payment_settings_header %} <template #smart-bar-header> <h2> {{ $tc('sw-settings.index.title') }} <mt-icon :name="arrowIconName" small /> {{ $tc('klarna-payment-configuration.settingsForm.title') }} </h2> </template> {% endblock %} {% block klarna_payment_settings_actions %} <template #smart-bar-actions> {% block klarna_payment_settings_actions_wizard %} <mt-button :disabled="isLoading || isTesting" variant="secondary" size='default' @click="onWizard"> {{ $tc('klarna-payment-configuration.settingsForm.buttons.wizard') }} </mt-button> {% endblock %} {% block klarna_payment_settings_actions_test %} <sw-button-process :is-loading="isTesting" :process-success="isTestSuccessful" @update:process-success="onTestFinished()" :disabled="isLoading" @click="onTest()"> {{ $tc('klarna-payment-configuration.settingsForm.buttons.test') }} </sw-button-process> {% endblock %} {% block klarna_payment_settings_actions_save %} <sw-button-process class="sw-settings-login-registration__save-action" :is-loading="isLoading" :process-success="isSaveSuccessful" @update:process-success="onSaveFinished()" :disabled="isLoading || isTesting" variant="primary" @click="onSave"> {{ $tc('klarna-payment-configuration.settingsForm.buttons.save') }} </sw-button-process> {% endblock %} </template> {% endblock %} {% block klarna_payment_settings_content %} <template #content> <mt-card :hero="true" :isLoading="false" :large="false"> <sw-alert variant="info" appearance="default" :show-icon="true" :closable="false"> {{ $tc('klarna-payment-configuration.settingsForm.inheritanceWarning') }} </sw-alert> </mt-card> <mt-card v-if="showNotificationGlobalPurchaseFlowMissing"> <sw-alert variant="info" appearance="default" :show-icon="true" :closable="false"> {{ $tc('klarna-payment-configuration.settingsForm.globalPurchaseMissingInfo') }} </sw-alert> </mt-card> <sw-card-view> <sw-system-config ref="systemConfig" salesChannelSwitchable inherit @config-changed="onConfigChange" @saleschannel-changed="setSalesChannelDomainsWithoutHttps" domain="KlarnaPayment.settings"> <template #beforeElements="{ card, config }"> <template v-if="!showNotificationGlobalPurchaseFlowMissing"> <template v-if="card.name == 'payment_settings'"> <sw-alert variant="info" appearance="default" :show-icon="true" :closable="false"> {{ $tc('klarna-payment-configuration.settingsForm.deprecatedConfiguration') }} </sw-alert> </template> </template> </template> <template #card-element="{ element, config }"> <div v-show="displayField(element, config)"> <div v-if="element.name.endsWith('testMode')"> <sw-alert variant="info" appearance="pill"> {{ $tc('klarna-payment-configuration.settingsForm.apiConfiguration.notice') }} </sw-alert> </div> <sw-form-field-renderer v-bind="$refs.systemConfig.getElementBind(element)" v-model:value="$refs.systemConfig.actualConfigData[$refs.systemConfig.currentSalesChannelId][element.name]" /> <div v-if="element.name.endsWith('isOnsiteMessagingActive')" class="klarna-field--osm-description"> <p> <a v-if="getConfigValue('testMode')" target="_blank" :href="$tc('klarna-payment-configuration.settingsForm.onsiteMessaging.playgroundUrl')"> <mt-button size="x-small"> {{ $tc('klarna-payment-configuration.settingsForm.onsiteMessaging.generate')}} </mt-button> </a> <a v-else target="_blank" :href="$tc('klarna-payment-configuration.settingsForm.onsiteMessaging.defaultUrl')"> <mt-button size="x-small"> {{ $tc('klarna-payment-configuration.settingsForm.onsiteMessaging.generate')}} </mt-button> </a> </p> </div> </div> </template> </sw-system-config> </sw-card-view> </template> {% endblock %} </sw-page> {% endblock %}`,L=`{% block klarna_payment_settings %} <sw-page class="klarna-payment"> {% block klarna_payment_settings_header %} <template #smart-bar-header> <h2> {{ $tc('sw-settings.index.title') }} <mt-icon :name="arrowIconName" small /> {{ $tc('klarna-payment-configuration.settingsForm.title') }} </h2> </template> {% endblock %} {% block klarna_payment_settings_actions %} <template #smart-bar-actions> {% block klarna_payment_settings_actions_wizard %} <mt-button :disabled="isLoading || isTesting" variant="secondary" size='default' @click="onWizard"> {{ $tc('klarna-payment-configuration.settingsForm.buttons.wizard') }} </mt-button> {% endblock %} {% block klarna_payment_settings_actions_test %} <sw-button-process :is-loading="isTesting" :process-success="isTestSuccessful" @update:process-success="onTestFinished()" :disabled="isLoading" @click="onTest()"> {{ $tc('klarna-payment-configuration.settingsForm.buttons.test') }} </sw-button-process> {% endblock %} {% block klarna_payment_settings_actions_save %} <sw-button-process class="sw-settings-login-registration__save-action" :is-loading="isLoading" :process-success="isSaveSuccessful" @update:process-success="onSaveFinished()" :disabled="isLoading || isTesting" variant="primary" @click="onSave"> {{ $tc('klarna-payment-configuration.settingsForm.buttons.save') }} </sw-button-process> {% endblock %} </template> {% endblock %} {% block klarna_payment_settings_content %} <template #content> <sw-card-view> <mt-card v-if="showNotificationGlobalPurchaseFlowMissing"> <sw-alert variant="info" appearance="default" :show-icon="true" :closable="false"> {{ $tc('klarna-payment-configuration.settingsForm.globalPurchaseMissingInfo') }} </sw-alert> </mt-card> <sw-system-config ref="systemConfig" sales-channel-switchable inherit @config-changed="onConfigChange" @saleschannel-changed="setSalesChannelDomainsWithoutHttps" domain="KlarnaPayment.settings" > <template #beforeElements="{ card, config }"> <template v-if="!showNotificationGlobalPurchaseFlowMissing"> <template v-if="card.name == 'payment_settings'"> <sw-alert variant="info" appearance="default" :show-icon="true" :closable="false"> {{ $tc('klarna-payment-configuration.settingsForm.deprecatedConfiguration') }} </sw-alert> </template> </template> </template> <template #card-element="{ element, config }"> <sw-inherit-wrapper v-model:value="$refs.systemConfig.actualConfigData[$refs.systemConfig.currentSalesChannelId][element.name]" v-bind="$refs.systemConfig.getInheritWrapperBind(element)" :has-parent="$refs.systemConfig.isNotDefaultSalesChannel" :inherited-value="$refs.systemConfig.getInheritedValue(element)" :class="'sw-system-config--field-' + $refs.systemConfig.kebabCase($refs.systemConfig.getElementBind(element).name)" > <template #content="props"> <div v-show="displayField(element, config)"> <div v-if="element.name.endsWith('testMode')"> <sw-alert variant="info" appearance="pill"> {{ $tc('klarna-payment-configuration.settingsForm.apiConfiguration.notice') }} </sw-alert> </div> <sw-form-field-renderer v-bind="$refs.systemConfig.getElementBind(element, props)" :key="props.isInheritField + props.isInherited" :disabled="props.isInherited" :value="props.currentValue" @update:value="props.updateCurrentValue" /> <div v-if="element.name.endsWith('isOnsiteMessagingActive')" class="klarna-field--osm-description"> <p> <a v-if="getConfigValue('testMode')" target="_blank" :href="$tc('klarna-payment-configuration.settingsForm.onsiteMessaging.playgroundUrl')"> <mt-button size="x-small"> {{ $tc('klarna-payment-configuration.settingsForm.onsiteMessaging.generate')}} </mt-button> </a> <a v-else target="_blank" :href="$tc('klarna-payment-configuration.settingsForm.onsiteMessaging.defaultUrl')"> <mt-button size="x-small"> {{ $tc('klarna-payment-configuration.settingsForm.onsiteMessaging.generate')}} </mt-button> </a> </p> </div> </div> </template> </sw-inherit-wrapper> </template> </sw-system-config> </sw-card-view> </template> {% endblock %} </sw-page> {% endblock %}`,{Component:N,Mixin:v,Context:u}=Shopware,{Criteria:l}=Shopware.Data,q=u.app.config.version,d=q.match(/((\d+)\.?(\d+?)\.?(\d+)?\.?(\d*))-?([A-z]+?\d+)?/i);let $=B;d&&parseInt(d[2],10)===6&&(parseInt(d[3],10)>3||parseInt(d[4],10)>4)&&($=L);N.register("klarna-payment-settings",{template:$,mixins:[v.getByName("notification"),v.getByName("sw-inline-snippet")],inject:["repositoryFactory","KlarnaPaymentConfigurationService"],data(){return{euApiRegionKey:"",usApiRegionKey:"",apiRegionKeys:[],isLoading:!1,isTesting:!1,isTestSuccessful:!1,isSaveSuccessful:!1,config:{},paymentMethods:[],externalCheckoutPaymentMethods:[],configDomain:"KlarnaPayment.settings.",salesChannelDomainsWithoutHttps:[],showNotificationGlobalPurchaseFlowMissing:!1}},metaInfo(){return{title:this.$createTitle()}},created(){this.createdComponent()},computed:{paymentMethodRepository(){return this.repositoryFactory.create("payment_method")},salesChannelDomainRepository(){return this.repositoryFactory.create("sales_channel_domain")},arrowIconName(){return d[3]>=5?"regular-chevron-right-xs":"small-arrow-medium-right"}},methods:{createdComponent(){const e=this;this.setSalesChannelDomainsWithoutHttps(),this.paymentMethodRepository.search(new l,u.api).then(t=>{t.forEach(a=>{e.paymentMethods.push({value:a.id,label:a.name}),a.formattedHandlerIdentifier==="handler_swag_paypalpaymenthandler"&&e.externalCheckoutPaymentMethods.push({value:a.id,label:a.name})})}),this.KlarnaPaymentConfigurationService.getEuApiRegionKey().then(t=>{e.euApiRegionKey=t.data.key,e.apiRegionKeys.push(e.euApiRegionKey)}),this.KlarnaPaymentConfigurationService.getUsApiRegionKey().then(t=>{e.usApiRegionKey=t.data.key,e.apiRegionKeys.push(e.usApiRegionKey)})},setSalesChannelDomainsWithoutHttps(){const e=this;let t=new l;t.addFilter(l.not("AND",[l.contains("url","https://")])),this.$refs.systemConfig&&this.$refs.systemConfig.currentSalesChannelId&&t.addFilter(l.equals("salesChannelId",this.$refs.systemConfig.currentSalesChannelId)),e.salesChannelDomainsWithoutHttps=[],this.salesChannelDomainRepository.search(t,u.api).then(a=>{a.forEach(n=>{e.salesChannelDomainsWithoutHttps.push(n.url)})})},getConfigValue(e){if(this.$refs.systemConfig===void 0)return null;const t=this.$refs.systemConfig.currentSalesChannelId,a=this.$refs.systemConfig.actualConfigData.null[this.configDomain+e];if(t===null)return a;const n=this.config[this.configDomain+e];return n??a},onTest(){this.testCredentials(!1)},testCredentials(e){const t=this;let a=t.apiRegionKeys.length;t.apiRegionKeys.forEach(n=>{e?(this.isSaveSuccessful=!1,this.isLoading=!0):(t.isTestSuccessful=!1,t.isTesting=!0);const r={testMode:t.getConfigValue("testMode"),salesChannel:t.$refs.systemConfig.currentSalesChannelId};let i=n===t.usApiRegionKey?"US":"";if(r.apiUsername=t.getConfigValue("apiUsername"+i),r.apiPassword=t.getConfigValue("apiPassword"+i),r.testApiUsername=t.getConfigValue("testApiUsername"+i),r.testApiPassword=t.getConfigValue("testApiPassword"+i),!t.shouldTestCredentials(r)){--a,t.releaseLoadingAndSave(e,a);return}t.KlarnaPaymentConfigurationService.validateCredentials(r,n).then(()=>{t.createNotificationSuccess({title:t.$tc("klarna-payment-configuration.settingsForm.messages.titleSuccess"),message:t.$tc("klarna-payment-configuration.settingsForm.messages.messageTest"+n+"Success")}),e?t.isSaveSuccessful=!0:t.isTestSuccessful=!0,--a}).catch(()=>{t.createNotificationError({title:t.$tc("klarna-payment-configuration.settingsForm.messages.titleError"),message:t.$tc("klarna-payment-configuration.settingsForm.messages.messageTest"+n+"Error"+(r.testMode?"Test":"Live"))})}).finally(()=>{t.releaseLoadingAndSave(e,a)})})},releaseLoadingAndSave(e,t){const a=this;e?(a.isLoading=!1,t<=0&&a.$refs.systemConfig.saveAll()):a.isTesting=!1},shouldTestCredentials(e){return e.testMode?e.testApiPassword&&e.testApiPassword.length>0||e.testApiUsername&&e.testApiUsername.length>0:e.apiPassword&&e.apiPassword.length>0||e.apiUsername&&e.apiUsername.length>0},onSave(){this.testCredentials(!0)},onConfigChange(e){this.config=e,this.showNotificationGlobalPurchaseFlowMissing=!this.getConfigValue("activeGlobalPurchaseFlow"),this.redirectToWizard()},redirectToWizard(){this.getConfigValue("isInitialized")||this.$router.push({name:"klarna.payment.configuration.wizard"})},onSaveFinished(){this.isSaveSuccessful=!1},onTestFinished(){this.isTestSuccessful=!1},getBind(e,t){return t!==this.config&&(this.config=t),e},onWizard(){this.$router.push({name:"klarna.payment.configuration.wizard"})},displayField(e,t){return e.name===`${this.configDomain}isInitialized`||e.name===`${this.configDomain}activeGlobalPurchaseFlow`?!1:e.name===`${this.configDomain}onsiteMessagingScript`?t[`${this.configDomain}isOnsiteMessagingActive`]==null?this.getConfigValue("isOnsiteMessagingActive")===!0:t[`${this.configDomain}isOnsiteMessagingActive`]===!0:e.name===`${this.configDomain}onsiteMessagingSnippet`?t[`${this.configDomain}isOnsiteMessagingActive`]==null?this.getConfigValue("isOnsiteMessagingActive")===!0:t[`${this.configDomain}isOnsiteMessagingActive`]===!0:e.name.replace(this.configDomain,"").indexOf("klarnaExpress")===0?t[`${this.configDomain}isKlarnaExpressCheckoutActive`]==null?this.getConfigValue("isKlarnaExpressCheckoutActive")===!0:t[`${this.configDomain}isKlarnaExpressCheckoutActive`]===!0:e.name===`${this.configDomain}captureOrderStatus`?this.getConfigValue("automaticCapture")==="orderStatus":e.name===`${this.configDomain}captureDeliveryStatus`?this.getConfigValue("automaticCapture")==="deliveryStatus":e.name===`${this.configDomain}refundOrderStatus`?this.getConfigValue("automaticRefund")==="orderStatus":e.name===`${this.configDomain}refundDeliveryStatus`?this.getConfigValue("automaticRefund")==="deliveryStatus":e.name===`${this.configDomain}newsletterCheckboxLabel`?t[`${this.configDomain}enableNewsletterCheckbox`]:e.name===`${this.configDomain}accountCheckboxLabel`?t[`${this.configDomain}enableAccountCheckbox`]:e.name===`${this.configDomain}kcoFooterBadgeStyle`?t[`${this.configDomain}kcoDisplayFooterBadge`]:e.name===`${this.configDomain}kcoFooterBadgeCountryCode`?t[`${this.configDomain}kcoDisplayFooterBadge`]:e.name===`${this.configDomain}kcoFooterBadgeWidth`?t[`${this.configDomain}kcoDisplayFooterBadge`]:!0}}});const H=`{% block klarna_payment_wizard %} <sw-page class="klarna-payment--wizard" v-bind:class="{ 'is--mobile': isMobile }"> {% block klarna_payment_wizard_header %} <template #smart-bar-header> <h2> {{ $tc('klarna-payment-configuration.wizard.title') }} </h2> </template> {% endblock %} {% block klarna_payment_wizard_content %} <template #content> <sw-card-view> <mt-card :is-loading="isLoading"> <sw-container columns="1fr 3fr" class="klarna-payment-detail--transaction-details" gap="0px 32px"> <sw-container> <sw-step-display class="wizard-navigation" :item-index="step" :item-variant="stepVariant"> <sw-step-item> {{ $tc('klarna-payment-configuration.wizard.steps.welcome') }} </sw-step-item> <sw-step-item> {{ $tc('klarna-payment-configuration.wizard.steps.salesChannel') }} </sw-step-item> <sw-step-item> {{ $tc('klarna-payment-configuration.wizard.steps.documentation') }} </sw-step-item> </sw-step-display> </sw-container> <sw-container> <sw-container v-if="step == 0" gap="20px 0px"> <sw-container> <div class="logo"> <img src="https://cdn.klarna.com/1.0/shared/image/generic/logo/de_de/basic/logo_black.png" alt="logo"> </div> </sw-container> <sw-container> <span v-html=" $tc('klarna-payment-configuration.wizard.content.welcome.customer')"></span> </sw-container> <sw-container> <span v-html="$tc('klarna-payment-configuration.wizard.content.welcome.registration')"></span> </sw-container> <sw-container> <span v-html="$tc('klarna-payment-configuration.wizard.content.welcome.installation')"></span> </sw-container> </sw-container> <sw-container v-if="step == 1" gap="20px 0px"> <sw-sales-channel-switch :label="$tc('sw-settings.system-config.labelSalesChannelSelect')" @change-sales-channel-id="onSalesChannelChanged"> </sw-sales-channel-switch> <template v-for="(item, index) in salesChannels"> <sw-container :class="item.id" v-if="item.id == currentSalesChannelId"> <sw-container> {{ $tc('klarna-payment-configuration.wizard.klarnaProduct') }} </sw-container> <sw-container> {% block klarna_payment_wizard_content_payment_select %} <sw-single-select v-model:value="item.klarnaType" class="klarna-settings-wizard-content-payment-select" size="small" :options="klarnaWizardPaymentOptions" /> {% endblock %} </sw-container> </sw-container> </template> </sw-container> <sw-container v-if="step == 2" gap="20px 0px"> <sw-container> <span v-html="$tc('klarna-payment-configuration.wizard.content.documentation.headline')"></span> </sw-container> <sw-container> <span v-html="$tc('klarna-payment-configuration.wizard.content.documentation.introduction')"></span> </sw-container> <sw-container> <span v-html="$tc('klarna-payment-configuration.wizard.content.documentation.conclusion')"></span> </sw-container> </sw-container> </sw-container> </sw-container> <sw-container columns="1fr 1fr" gap="32px 32px" class="wizard-footer"> <mt-button :disabled="step == minStep" size="small" @click="onBack" variant="secondary"> <b>{{ $tc('klarna-payment-configuration.wizard.action.back') }}</b> </mt-button> <mt-button v-if="step != maxStep" size="small" variant="primary" @click="onNext"> {{ $tc('klarna-payment-configuration.wizard.action.next') }} </mt-button> <mt-button v-if="step == maxStep" size="small" variant="primary" @click="onFinish"> {{ $tc('klarna-payment-configuration.wizard.action.finish') }} </mt-button> </sw-container> </mt-card> </sw-card-view> </template> {% endblock %} </sw-page> {% endblock %}`,{Component:V,Mixin:C}=Shopware;V.register("klarna-payment-wizard",{template:H,mixins:[C.getByName("notification"),C.getByName("sw-inline-snippet")],inject:["KlarnaPaymentWizardService"],data(){return{isLoading:!0,currentSalesChannelId:null,splitBreakpoint:1024,minStep:0,maxStep:2,isInitialized:!1,salesChannels:[],isMobile:null,step:0,stepVariant:"info",klarnaWizardPaymentOptions:[{label:this.$tc("klarna-payment-configuration.wizard.type.deactivated"),value:"deactivated",key:"deactivated"},{label:this.$tc("klarna-payment-configuration.wizard.type.payments"),value:"payments",key:"payments"}]}},created(){this.createdComponent()},methods:{createdComponent(){this.checkViewport(),this.registerListener(),this.loadTableData()},loadTableData(){this.KlarnaPaymentWizardService.fetchData().then(e=>{this.salesChannels=e.data.salesChannels,this.isInitialized=e.data.isInitialized}).catch(()=>{this.createErrorNotification({title:this.$tc("klarna-payment-configuration.wizard.messages.titleError"),message:this.$tc("klarna-payment-configuration.wizard.messages.messageLoadError")})}).finally(()=>{this.isLoading=!1})},registerListener(){this.$device.onResize({listener:this.checkViewport.bind(this)})},checkViewport(){this.isMobile=this.$device.getViewportWidth()<this.splitBreakpoint},onNext(){this.step=this.step+1,this.step>this.maxStep&&(this.step=this.maxStep)},onBack(){this.step=this.step-1,this.step<this.minStep&&(this.step=this.minStep)},onFinish(){this.isLoading=!0,this.KlarnaPaymentWizardService.finalizeInstallation(this.salesChannels).then(()=>{this.createNotificationSuccess({title:this.$tc("klarna-payment-configuration.wizard.messages.titleSuccess"),message:this.$tc("klarna-payment-configuration.wizard.messages.messageSaveSuccess")}),this.$router.push({name:"klarna.payment.configuration.settings"})}).catch(()=>{this.createErrorNotification({title:this.$tc("klarna-payment-configuration.wizard.messages.titleError"),message:this.$tc("klarna-payment-configuration.wizard.messages.messageSaveError")})}).finally(()=>{this.isLoading=!1})},onSalesChannelChanged(e){this.currentSalesChannelId=e}}});const W={"klarna-payment-configuration":{module:{title:"Klarna.",description:"Klarna."},settingsForm:{title:"Klarna",inheritanceWarning:"Die Darstellung der Vererbung für die Plugin-Konfiguration wurde mit Shopware 6.3.4.0 optimiert. Bitte aktualisieren Sie Ihr System, wenn Sie die Vererbung sicher verwenden möchten.",apiConfiguration:{notice:"Bitte beachten Sie, dass der Test- und Debug-Modus nicht individuell pro Region konfiguriert werden kann, da der entsprechende Endpunkt anhand der Rechnungsadresse gewählt wird.",modal:{title:"Achtung: Risiko bei deaktivierter Adressvalidierung",text:"Wenn die Adressvalidierung deaktiviert ist, kann es dazu kommen, dass die Versandadresse nicht mehr mit der ursprünglich von Klarna akzeptierten Adresse übereinstimmt. Bitte beachte, dass in solchen Fällen du als Händler das Risiko trägst, dass bei einem Klärfall gegen dich entschieden wird. Mehr Informationen findest du in unserem"}},globalPurchaseMissingInfo:"Sofort bezahlen, Pay Later und Ratenkauf werden zu einer einzigen Zahlungsmethode zusammengefasst: Bezahlen mit Klarna. Jeder Klarna-Kunde wird in Kürze automatisch auf diese neue Zahlungsmethode migriert. Der Status Ihrer Migration wird jedes Mal überprüft, wenn ein Kunde die Seite zur Bestellbestätigung aufruft. Diese Meldung verschwindet automatisch, sobald Sie migriert sind",deprecatedConfiguration:"Sofort bezahlen, Pay Later und Ratenkauf sind jetzt in einer Zahlungsmethode kombiniert: Bezahlen mit Klarna. Diese Konfiguration wird nicht mehr benötigt und wird in einer zukünftigen Version entfernt.",messages:{titleSuccess:"Erfolg",titleError:"Fehler",messageTestEUSuccess:"Die API-Zugangsdaten für Europa wurden erfolgreich validiert.",messageTestUSSuccess:"Die API-Zugangsdaten für Nordamerika wurden erfolgreich validiert.",messageTestEUErrorLive:"Die API-Zugangsdaten für Europa konnten nicht validiert werden.",messageTestEUErrorTest:"Die API-Zugangsdaten für Europa des Testmodus konnten nicht validiert werden.",messageTestUSErrorLive:"Die API-Zugangsdaten für Nordamerika konnten nicht validiert werden.",messageTestUSErrorTest:"Die API-Zugangsdaten für Nordamerika des Testmodus konnten nicht validiert werden.",messageSaveSuccess:"Die Plugin-Einstellungen wurden gespeichert.",messageSaveError:"Die Plugin-Einstellungen konnten nicht gespeichert werden.",messageMissingApiUsername:'Für den aktiven Modus wurde kein Wert für die Option "Api-Benutzername" angegeben!',messageMissingApiPassword:'Für den aktiven Modus wurde kein Wert für die Option "Api-Password" angegeben!'},buttons:{save:"Einstellungen speichern",test:"API-Zugangsdaten testen",wizard:"Wizard starten"},onsiteMessaging:{generate:"Generiere deine Daten hier",playgroundUrl:"https://playground.eu.portal.klarna.com/on-site-messaging/#realm=merchants",defaultUrl:"https://eu.portal.klarna.com/on-site-messaging/#realm=merchants"},klarnaPayments:{payLater:{description:'Die Option "Rechnung" macht Kunden den Bezahlvorgang einfach und schnell, ohne dabei persönliche Daten oder komplizierte Nummern eingeben zu müssen. Der Kunde hat die Wahl zwischen Rechnung und im Monat X bezahlen.',title:"Pay Later"},sliceIt:{description:`Mittels "Ratenkauf" können Kunden die Einkaufssumme bei geringen Zinsen in Häppchen aufteilen. Das erhöht den Investitionsrahmen und die Kaufkraft. Klarna's einzigartige Kreditbearbeitung erfordert nur wenige Augenblicke und minimale Dateneingabe. Der Kunde hat die Wahl zwischen fixen und flexiblen Raten.`,title:"Ratenkauf"},payNow:{additional:'Für "Sofort bezahlen" müssen sowohl die kombinierte Zahlungsmethode "Sofort bezahlen" als auch die einzelnen Zahlungsmethoden "Kreditkarte", "Lastschrift" und "Sofortüberweisung" zu den Verkaufskanälen hinzugefügt werden.',description:'Kunden, die Beträge sofort vollständig beim Bestellabschluss bezahlen möchten, können die Option "Sofort bezahlen" nutzen. Zur Auswahl stehen hierbei Kreditkarte, Lastschrift und die Sofortüberweisung.',title:"Sofort bezahlen"}}},wizard:{title:"Wizard",klarnaProduct:"Genutztes Klarna Produkt",steps:{welcome:"Willkommen",salesChannel:"Verkaufskanal",documentation:"Dokumentation"},content:{welcome:{customer:"Sind Sie bereits Klarna Händler? Klicken Sie bitte auf Weiter.",registration:"Sofern Sie noch keine Registrierung bei Klarna vorgenommen haben, wenden Sie sich bitte per email an <a href='mailto:vertrieb&commat;klarna.com'>vertrieb&commat;klarna.com</a>.",installation:"Für die Einrichtung und Verwendung des Plugins finden Sie die Installationsanleitung&nbsp;<a href='https://bit.ly/klarna-shopware-6-installationguide-de'>HIER</a>."},documentation:{headline:"Vielen Dank. Die Konfiguration von Klarna ist abgeschlossen.",introduction:"Egal was Sie verkaufen, unsere Produkte sind dafür gemacht, Ihren Kunden das Beste und Ihnen das zufriedenste Kundenerlebnis zu bereiten. Wir unterstützen Sie online dabei, eine große Auswahl an Zahlungsmöglichkeiten anzubieten.",conclusion:"Um mehr über Klarna zu erfahren, klicken Sie bitte&nbsp;<a href='https://bit.ly/klarna-shopware-6-installationguide-de'>HIER</a>."}},type:{deactivated:"Deaktiviert",payments:"Klarna Payments",checkout:"Klarna Checkout"},action:{back:"Zurück",next:"Weiter",finish:"Fertig"},messages:{titleSuccess:"Erfolg",titleError:"Fehler",messageLoadError:"Der Wizard konnte nicht geladen werden.",messageSaveSuccess:"Die Einrichtung wurde erfolgreich abgeschlossen.",messageSaveError:"Die Einrichtung konnte nicht erfolgreich abgeschlossen werden."}}}},U={"klarna-payment-configuration":{module:{title:"Klarna.",description:"Klarna."},settingsForm:{title:"Klarna",inheritanceWarning:"The display of inheritance for plugin configuration has been optimized with Shopware 6.3.4.0. Please update your system if you want to use inheritance safely.",apiConfiguration:{notice:"Please note that the test and debug mode can't be configured individually per region as the corresponding endpoint is selected based on the billing address.",modal:{title:"Warning: Risk When Address Validation Is Disabled",text:"Disabling address validation may result in the shipping address no longer matching the one originally approved by Klarna. Please note that in such cases, you as the merchant bear the risk of a dispute being decided against you. For more information, please refer to our"}},globalPurchaseMissingInfo:"Pay Now, Pay Later and Financing will be combined into one payment method: Pay with Klarna. Every Klarna customer will soon be automatically migrated to this Global Purchase Flow. The status of your migration will be checked every time a customer accesses the order-confirmation page. This message will disappear once you have been migrated.",deprecatedConfiguration:"Pay Now, Pay Later and Financing are now combined into one payment method: Pay with Klarna. This configuration is not needed anymore and will be removed in a future version.",messages:{titleSuccess:"Success",titleError:"Error",messageTestEUSuccess:"The API credentials for Europe were successfully validated.",messageTestUSSuccess:"The API credentials for North America were successfully validated.",messageTestEUErrorLive:"The API credentials for Europe could not be validated.",messageTestEUErrorTest:"The test mode API credentials for Europe could not be validated.",messageTestUSErrorLive:"The API credentials for North America could not be validated.",messageTestUSErrorTest:"The test mode API credentials for North America could not be validated.",messageSaveSuccess:"The plugin settings have been saved.",messageSaveError:"The plugin settings could not be saved.",messageMissingApiUsername:'No value has been provided for field "API Username" related to the active mode!',messageMissingApiPassword:'No value has been provided for field "API Password" related to the active mode!'},buttons:{save:"Save settings",test:"Test API credentials",wizard:"Start Wizard"},onsiteMessaging:{generate:"Generate your data here",playgroundUrl:"https://playground.eu.portal.klarna.com/on-site-messaging/#realm=merchants",defaultUrl:"https://eu.portal.klarna.com/on-site-messaging/#realm=merchants"},klarnaPayments:{payLater:{description:"The option to pay later makes buying quicker and easier for customers: no need to fill out lengthy personal details or card number online.",title:"Pay Later"},sliceIt:{description:"Your customers can spread the cost of their purchases at a low interest rate, giving them flexibility and increased purchasing power. Our unique credit application requires minimal information and takes just seconds to complete.",title:"Financing"},payNow:{additional:'To use "Pay Now", you have to assign the payment methods "Pay Now", "Credit Card", "Direct Debit" and "Online Bank Transfer" to your sales channels.',description:"Customers who want to pay in full at checkout can do it quickly and securely with Klarna's Pay Now-option - using credit/debit card or direct bank transfer: Klarna Direkt, Sofort, SEPA Direct Debit.",title:"Pay Now"}}},wizard:{title:"Wizard",klarnaProduct:"Used Klarna product",steps:{welcome:"Welcome",salesChannel:"Sales channel",documentation:"Documentation"},content:{welcome:{customer:"Are you already a Klarna merchant? Please click Next.",registration:"If you have not yet registered with Klarna, please send an email to <a href='mailto:vertrieb&commat;klarna.com'>vertrieb&commat;klarna.com</a>.",installation:"For setup and handling of the Klarna plugin you can find the installation guide&nbsp;<a target='_blank' href='https://bit.ly/klarna-shopware-6-installationguide-en'>HERE</a>."},documentation:{headline:"Thank you. The configuration of Klarna is completed.",introduction:"Klarna Payments are standalone payment methods. With Klarna Payments you can complement your checkout with a Klarna hosted widget located in your existing checkout. We support your online business to offer a wide range of payment options.",conclusion:"To learn more about Klarna, please click&nbsp;<a target='_blank' href='https://bit.ly/klarna-shopware-6-installationguide-en'>HERE</a>."}},type:{deactivated:"Deactivated",payments:"Klarna Payments",checkout:"Klarna Checkout"},action:{back:"Back",next:"Next",finish:"Finish"},messages:{titleSuccess:"Success",titleError:"Error",messageLoadError:"The wizard couldn't be loaded.",messageSaveSuccess:"Initial setup completed successfully.",messageSaveError:"The initial setup could not be completed successfully."}}}},{Module:j}=Shopware;let Z={type:"plugin",name:"KlarnaPayment",title:"klarna-payment-configuration.module.title",description:"klarna-payment-configuration.module.description",version:"1.0.0",targetVersion:"1.0.0",snippets:{"de-DE":W,"en-GB":U},routes:{settings:{component:"klarna-payment-settings",path:"settings",meta:{parentPath:"sw.settings.index"}},wizard:{component:"klarna-payment-wizard",path:"wizard",meta:{parentPath:"sw.settings.index"}}},settingsItem:{name:"klarna-payment-configuration",to:"klarna.payment.configuration.settings",label:"klarna-payment-configuration.module.title",group:"plugins",iconComponent:"klarna-payment-plugin-icon"}};j.register("klarna-payment-configuration",Z);const G=`{% block sw_order_detail_content_tabs_general %} {% parent %} <template v-for="transaction in klarnaTransactions"> {% block klarna_payment_payment_tab %} <sw-tabs-item :route="{name: 'klarna-payment-order-management.payment.detail', params: { id: $route.params.id, transaction: transaction.transaction } }" :title="$tc('klarna-payment-order-management.order-tab.title')"> <span :class="transaction.cancelled ? 'klarna-tab-error' : ''"> {{ $tc('klarna-payment-order-management.order-tab.title') }} <mt-icon v-if="transaction.cancelled" class="klarna-error-badge" name="regular-info-circle" size="14px" v-tooltip="{ message: $tc('klarna-payment-order-management.tooltips.transactionCancelled') }" /> </span> </sw-tabs-item> {% endblock %} </template> {% endblock %}`,{Component:J,Context:Q}=Shopware,{Criteria:Y}=Shopware.Data;J.override("sw-order-detail",{template:G,data(){return{klarnaTransactions:[]}},computed:{isEditable(){return this.klarnaTransactions.length===0||this.$route.name!=="klarna-payment-order-management.payment.detail"}},watch:{orderId:{deep:!0,handler(){this.klarnaTransactions=[],this.orderId&&this.loadOrderData()},immediate:!0}},methods:{loadOrderData(){const e=this.repositoryFactory.create("order"),t=new Y(1,1);return t.addAssociation("transactions"),t.addAssociation("transactions.stateMachineState"),e.get(this.$route.params.id,Q.api,t).then(a=>{this.loadKlarnaTransactions(a)})},loadKlarnaTransactions(e){e.transactions.forEach(t=>{t.customFields&&t.customFields.klarna_order_id&&this.klarnaTransactions.push({transaction:t.id,cancelled:t.stateMachineState.technicalName==="cancelled"})})}}});const{Component:X,Mixin:ee}=Shopware;X.override("sw-order-detail-base",{inject:["KlarnaPaymentOrderUpdateService"],mixins:[ee.getByName("notification")],methods:{onSaveEdits(){this.$emit("loading-change",!0),this.$emit("editing-change",!1),this.KlarnaPaymentOrderUpdateService.updateOrder(this.orderId,this.versionContext.versionId).then(async()=>{await this.$super("onSaveEdits")}).catch(()=>{this.createNotificationError({title:this.$tc("klarna-payment-order-management.messages.updateErrorTitle"),message:this.$tc("klarna-payment-order-management.messages.updateErrorMessage")}),this.versionContext.versionId=Shopware.Context.api.liveVersionId,this.reloadEntityData()})}}});const te=`{% block klarna_payment_payment_details %} <div class="klarna-payment-tab" v-bind:class="{ 'is--mobile': isMobile }"> <div v-if="!hasError && initialized"> <mt-card class="klarna-payment-details" :title="$tc('klarna-payment-order-management.order-details.title')"> <sw-container columns="1fr 1fr" class="klarna-payment-detail--transaction-details mobile--ready" gap="0px 32px"> <sw-container gap="5px"> <mt-text-field :disabled="true" :label="$tc('klarna-payment-order-management.order-details.klarnaReference')" :model-value="klarnaOrder.reference"></mt-text-field> <mt-text-field :disabled="true" :label="$tc('klarna-payment-order-management.order-details.orderAmount')" :model-value="currencyFilter(klarnaOrder.order_amount, klarnaOrder.currency.isoCode)"></mt-text-field> <mt-text-field :disabled="true" :label="$tc('klarna-payment-order-management.order-details.capturedAmount')" :model-value="currencyFilter(klarnaOrder.captured_amount, klarnaOrder.currency.isoCode) "></mt-text-field> <mt-text-field :disabled="true" :label="$tc('klarna-payment-order-management.order-details.refundedAmount')" :model-value="currencyFilter(klarnaOrder.refunded_amount, klarnaOrder.currency.isoCode) "></mt-text-field> <klarna-release-amount :klarnaOrder="klarnaOrder" v-on:reload="loadData" v-on:subComponentLoading="setSubComponentLoading"></klarna-release-amount> </sw-container> <sw-container gap="5px"> <mt-text-field :disabled="true" :label="$tc('klarna-payment-order-management.order-details.klarnaOrderId')" :model-value="klarnaOrder.order_id"></mt-text-field> <mt-text-field :disabled="true" :label="$tc('klarna-payment-order-management.order-details.klarnaStatus')" :model-value="klarnaOrder.order_status"></mt-text-field> <mt-text-field :disabled="true" :label="$tc('klarna-payment-order-management.order-details.initialPaymentMethod')" :model-value="klarnaOrder.initial_payment_method"></mt-text-field> <mt-text-field :helpText="$tc('klarna-payment-order-management.order-details.riskCheckHelpText')" :disabled="true" :label="$tc('klarna-payment-order-management.order-details.riskCheck')" :model-value="klarnaOrder.fraud_status"></mt-text-field> <klarna-payment-authorization :klarnaOrder="klarnaOrder" v-on:reload="loadData" v-on:subComponentLoading="setSubComponentLoading" ></klarna-payment-authorization> </sw-container> </sw-container> </mt-card> <mt-card class="klarna-payment-actions"> <sw-container columns="1fr 1fr 1fr" gap="32px 32px" class="mobile--ready"> <klarna-capture-button :klarnaOrder="klarnaOrder" v-on:reload="loadData"></klarna-capture-button> <klarna-refund-button :klarnaOrder="klarnaOrder" v-on:reload="loadData"></klarna-refund-button> <klarna-order-cancel :klarnaOrder="klarnaOrder" v-on:reload="loadData" v-on:subComponentLoading="setSubComponentLoading"></klarna-order-cancel> </sw-container> </mt-card> <klarna-transaction-history :klarnaHistory="klarnaHistory" :klarnaOrder="klarnaOrder" ></klarna-transaction-history> </div> <mt-loader v-if="isLoading || isSubComponentLoading" /> </div> {% endblock %}`,{Component:ae,Mixin:ne,Context:re}=Shopware,{Criteria:ie}=Shopware.Data;ae.register("klarna-payment-tab",{template:te,data(){return{identifier:"",initialized:!1,isLoading:!0,isSubComponentLoading:!1,hasError:!1,klarnaOrder:{},splitBreakpoint:1024,isMobile:!1,klarnaHistory:{},orderAmount:[]}},created(){this.createdComponent()},destroyed(){this.destroyedComponent()},watch:{$route(){this.loadData()}},mixins:[ne.getByName("notification")],inject:["KlarnaPaymentOrderService","repositoryFactory"],computed:{currencyFilter(){return Shopware.Filter.getByName("currency")}},methods:{createdComponent(){Shopware.Utils.EventBus.on("language-change",this.loadData),this.$device.onResize({listener:this.checkViewport.bind(this)}),this.checkViewport(),this.loadData()},destroyedComponent(){Shopware.Utils.EventBus.off("language-change",this.loadData)},checkViewport(){this.isMobile=this.$device.getViewportWidth()<this.splitBreakpoint},loadData(){if(this.$route.name!=="klarna-payment-order-management.payment.detail")return;const e=this;e.isLoading=!0,e.hasError=!1;const t=this.repositoryFactory.create("order_transaction"),a=new ie(1,1);return a.addAssociation("order"),a.addAssociation("order.lineItems"),t.get(this.$route.params.transaction,re.api,a).then(n=>{const r=n.customFields.klarna_order_id,i=n.order.salesChannelId;e.$emit("identifier-change",n.order.orderNumber),e.KlarnaPaymentOrderService.fetchOrderData(n.order.id,r,i).then(s=>{e.hasError=!1,e.initialized=!0,e.klarnaOrder=s.order,e._populateKlarnaOrderWithVariantInfo(n.order),e.klarnaOrder.salesChannel=i,e.klarnaOrder.swOrderId=n.order.id,e.klarnaOrder.orderTransactionId=this.$route.params.transaction,e.klarnaHistory=s.transactionHistory}).catch(()=>{e.createNotificationError({title:e.$tc("klarna-payment-order-management.messages.loadErrorTitle"),message:e.$tc("klarna-payment-order-management.messages.loadErrorMessage")}),e.hasError=!0}).finally(()=>{e.isLoading=!1})}).catch(()=>{e.createNotificationError({title:e.$tc("klarna-payment-order-management.messages.loadErrorTitle"),message:e.$tc("klarna-payment-order-management.messages.loadErrorMessage")}),e.hasError=!0,e.isLoading=!1})},_populateKlarnaOrderWithVariantInfo(e){this.klarnaOrder.order_lines.forEach(t=>{for(const a of e.lineItems)if(t.reference===a.payload.productNumber){t.options=a.payload.options;return}})},setSubComponentLoading(e){this.isSubComponentLoading=e}}});const se=`{% block klarna_payment_payment_details %} <div class="klarna-capture-button"> <sw-container v-tooltip="{message: $tc('klarna-payment-order-management.tooltips.captureImpossible'), disabled: buttonEnabled}" :key="buttonEnabled"> <mt-button class='cpt-btn' :disabled="!buttonEnabled" @click="openCaptureModal" size='default' variant="secondary"> {{ $tc('klarna-payment-order-management.buttons.captureAmount') }} </mt-button> </sw-container> <sw-modal v-if="showCaptureModal" @modal-close="closeCaptureModal" :title="$tc(\`klarna-payment-order-management.captureModal.title\`)" class="klarna-payment-detail--capture-modal"> <klarna-order-items :klarna-order="klarnaOrder" mode="capture" @select-item="onSelectItem" @change-quantity="onChangeQuantity"> </klarna-order-items> <div class="klarna-payment-detail--capture-modal--content"> <sw-container columns="1fr 1fr" gap="0 32px"> <mt-text-field :disabled="true" :label="$tc('klarna-payment-order-management.captureModal.orderAmount')" :model-value="currencyFilter(klarnaOrder.order_amount, klarnaOrder.currency.isoCode)" /> <mt-text-field :disabled="true" :label="$tc('klarna-payment-order-management.captureModal.capturedAmount')" :model-value="currencyFilter(klarnaOrder.captured_amount, klarnaOrder.currency.isoCode)" /> <mt-text-field :disabled="true" :label="$tc('klarna-payment-order-management.captureModal.remainingAmount')" :model-value="currencyFilter(klarnaOrder.remaining_amount, klarnaOrder.currency.isoCode)" /> <mt-number-field required="required" number-type="float" :step="null" :digits="2" :fill-digits="false" :allow-empty="false" :label="$tc('klarna-payment-order-management.captureModal.captureAmount')" v-model="captureAmount" :min="minCaptureValue" :max="maxCaptureAmount" /> </sw-container> <mt-textarea :help-text="$tc('klarna-payment-order-management.captureModal.descriptionHelpText')" @update:model-value="onChangeDescription" :label="$tc('klarna-payment-order-management.captureModal.labelComment')" v-model="description" /> </div> <template #modal-footer> <mt-button :disabled="isLoading" @click="closeCaptureModal" size="default" variant="secondary"> {{ $tc('klarna-payment-order-management.captureModal.close') }} </mt-button> <sw-button-process :is-loading="isLoading" :process-success="isCaptureSuccessful" @update:process-success="onCaptureFinished()" :disabled="isLoading" variant="primary" @click="captureOrder"> {{ $tc('klarna-payment-order-management.captureModal.submit') }} </sw-button-process> </template> </sw-modal> </div> {% endblock %}`,{Component:oe,Mixin:le}=Shopware;oe.register("klarna-capture-button",{template:se,mixins:[le.getByName("notification")],inject:["KlarnaPaymentOrderService"],props:{klarnaOrder:{type:Object,required:!0}},data(){return{isLoading:!1,hasError:!1,showCaptureModal:!1,isCaptureSuccessful:!1,selection:[],captureAmount:0,description:""}},computed:{buttonEnabled(){return!(this.klarnaOrder.fraud_status!=="ACCEPTED"||this.klarnaOrder.order_status==="CANCELLED"||this.klarnaOrder.remaining_amount<=0)},maxCaptureAmount(){return this.klarnaOrder.remaining_amount},minCaptureValue(){return .01},currencyFilter(){return Shopware.Filter.getByName("currency")}},methods:{openCaptureModal(){this.showCaptureModal=!0,this.isCaptureSuccessful=!1,this.captureAmount=this.klarnaOrder.remaining_amount,this.description="",this.selection=[]},calculateCaptureAmount(){let e=0;this.selection.forEach(t=>{t.selected&&(e+=t.unit_price/100*t.quantity)}),(e===0||e>this.klarnaOrder.remaining_amount)&&(e=this.klarnaOrder.remaining_amount),e=+e,e=Number(e.toFixed(2)),this.captureAmount=e},closeCaptureModal(){this.showCaptureModal=!1},onCaptureFinished(){this.isCaptureSuccessful=!1},captureOrder(){this.isLoading=!0;const e=[];this.selection.forEach(a=>{this.klarnaOrder.order_lines.forEach(n=>{if(n.reference===a.reference&&a.selected&&a.quantity){const r={...n};r.quantity=a.quantity,r.total_amount=r.unit_price*r.quantity;const i=r.tax_rate/100;r.total_tax_amount=Math.round(r.total_amount/(100+i)*i),e.push(r)}})});const t={orderTransactionId:this.klarnaOrder.orderTransactionId,order_id:this.klarnaOrder.swOrderId,klarna_order_id:this.klarnaOrder.order_id,salesChannel:this.klarnaOrder.salesChannel,captureAmount:this.captureAmount,description:this.description,orderLines:JSON.stringify(e),complete:this.captureAmount===this.maxCaptureAmount};this.KlarnaPaymentOrderService.captureOrder(t).then(()=>{this.createNotificationSuccess({title:this.$tc("klarna-payment-order-management.messages.captureSuccessTitle"),message:this.$tc("klarna-payment-order-management.messages.captureSuccessMessage")}),this.isCaptureSuccessful=!0}).catch(()=>{this.createNotificationError({title:this.$tc("klarna-payment-order-management.messages.captureErrorTitle"),message:this.$tc("klarna-payment-order-management.messages.captureErrorMessage")}),this.isCaptureSuccessful=!1}).finally(()=>{this.isLoading=!1,this.showCaptureModal=!1,this.$emit("reload")})},onSelectItem(e,t){this.selection.length===0&&this._populateSelectionProperty(),this.selection.forEach(a=>{a.reference===e&&(a.selected=t)}),this.calculateCaptureAmount()},onChangeQuantity(e,t){this.selection.length===0&&this._populateSelectionProperty(),this.selection.forEach(a=>{a.reference===e&&(a.quantity=t)}),this.calculateCaptureAmount()},onChangeDescription(e){e.length>=255?this.description=e.substr(0,255):this.description=e},_populateSelectionProperty(){this.klarnaOrder.order_lines.forEach(e=>{this.selection.push({quantity:e.quantity-e.captured_quantity,reference:e.reference,unit_price:e.unit_price,selected:!1})})}}});const de=`{# @var \\KlarnaPayment\\Components\\Client\\Response\\GetOrderResponse klarnaOrder #} {% block klarna_payment_payment_details %} <div class="klarna-order-items"> <sw-data-grid :data-source="orderItems" :columns="orderItemColumns" :show-actions="true" :show-selection="true" :allow-inline-edit="true" @inline-edit-save="onInlineEditSave" @select-item="onSelectItem"> <template #column-reference="{ item, isInlineEdit}"> <div v-tooltip="{ message: item.reference, disabled: item.reference.length <= 15 }"> {{ truncateFilter(item.reference, 15, true, '...') }} </div> </template> <template #column-product="{ item, isInlineEdit}"> <sw-product-variant-info :variations="item.options"> <div class="sw-order-line-items-grid__item-label"> {{ item.product }} </div> </sw-product-variant-info> </template> <template #column-price="{ item, isInlineEdit}"> {{ item.price }} </template> <template #column-stock="{ item, isInlineEdit }"> {% block klarna_order_items_stock_inline_edit %} <template v-if="isInlineEdit"> <mt-number-field v-model="item.amount" :size="small" @input-change="onChangeQuantity($event, item.id)" :disabled="item.disabled" :max="item.amount" /> </template> {% endblock %} {% block klarna_order_items_stock_content %} <template v-else> {{ item.amount }} </template> {% endblock %} </template> <template #column-returnStatus="{ item, isInlineEdit }"> <mt-skeleton-bar v-if="isReturnDataLoading" /> <ul v-else-if="!isReturnDataLoading && item.returnStatus"> <li v-for="(orderRefundLineItem, returnNumber) in item.returnStatus"> {{ $tc('swag-return-management.returnCard.labelTitle', 0, { returnNumber: returnNumber }) }}: {{ orderRefundLineItem.state.translated.name }} </li> </ul> <div v-else> {{ $tc('klarna-payment-order-management.refundModal.noReturnRequested') }} </div> </template> </sw-data-grid> </div> {% endblock %}`,{Component:ce,Context:Re,Application:Pe}=Shopware,{Criteria:Te}=Shopware.Data,{currency:me}=Shopware.Utils.format;ce.register("klarna-order-items",{template:de,props:{klarnaOrder:{type:Object,required:!0},mode:{type:String,required:!1},returnData:{type:Object,default(){return{}},required:!1},swagCommercialInstalled:{type:Boolean,default:!1,required:!1},isReturnDataLoading:{type:Boolean,default:!1,required:!1}},computed:{orderItems(){const e=[];return this.klarnaOrder.order_lines.forEach(t=>{const a=me(t.total_amount/100,this.klarnaOrder.currency);let n=!1,r=t.quantity;this.mode==="refund"&&t.captured_quantity>0&&(r=t.captured_quantity),this.mode==="capture"?r-=t.captured_quantity:this.mode==="refund"&&(r-=t.refunded_quantity),r<=0&&(n=!0),e.push({id:t.reference,reference:t.reference,product:t.name,options:t.options,amount:r,disabled:n,price:a,orderItem:t,returnStatus:this.returnData[t.reference]})}),e},orderItemColumns(){let e=[{property:"reference",label:this.$tc("klarna-payment-order-management.modal.columns.reference"),inlineEdit:"string",rawData:!0},{property:"product",label:this.$tc("klarna-payment-order-management.modal.columns.product"),inlineEdit:"string",rawData:!0},{property:"amount",label:this.$tc("klarna-payment-order-management.modal.columns.amount"),inlineEdit:"number",rawData:!0},{property:"price",label:this.$tc("klarna-payment-order-management.modal.columns.price"),inlineEdit:"number",rawData:!0}];return this.mode==="refund"&&this.swagCommercialInstalled&&e.push({property:"returnStatus",label:this.$tc("klarna-payment-order-management.modal.columns.returnStatus"),rawData:!0}),e},truncateFilter(){return Shopware.Filter.getByName("truncate")}},methods:{onSelectItem(e,t,a){this.$emit("select-item",t.id,a)},onInlineEditSave(e){let t=e.amount;t>e.orderItem.quantity&&(t=e.orderItem.quantity),e.amount=t,this.$emit("change-quantity",e.id,e.amount)}}});const ue=`{% block klarna_payment_authorization %} <sw-container class="klarna-extend-authorization"> <mt-text-field :help-text="$tc('klarna-payment-order-management.order-details.expiryDateHelpText')" :suffix="true" :disabled="true" :label="$tc('klarna-payment-order-management.order-details.expiryDate')" :model-value="dateFilter(klarnaOrder.expiry_date, { hour: '2-digit', minute: '2-digit' })"> <template #suffix> <sw-container v-tooltip="{message: $tc('klarna-payment-order-management.tooltips.extendAuthorizationImpossible'), disabled: !buttonDisabled}" :key="buttonDisabled"> <mt-button :disabled="buttonDisabled" @click="openModal" variant="secondary"> {{ $tc('klarna-payment-order-management.buttons.extendAuthorization') }} </mt-button> </sw-container> </template> </mt-text-field> <sw-modal class="klarna-payment-detail--authorization-modal klarna-authorization--modal" v-if="showModal" @modal-close="closeModal" :title="$tc('klarna-payment-order-management.authorizationModal.title')"> <div class="authorization-modal--text"> {{ $tc('klarna-payment-order-management.authorizationModal.content') }} </div> <template #modal-footer> <mt-button :disabled="isLoading" @click="closeModal" size='default' variant="secondary"> {{ $tc('klarna-payment-order-management.authorizationModal.close') }} </mt-button> <sw-button-process class="authorization-modal--action" variant="primary" :is-loading="isLoading" :disabled="isDisabled" :process-success="isSuccessful" @click="extendAuthorization"> {{ $tc('klarna-payment-order-management.authorizationModal.submit') }} </sw-button-process> </template> </sw-modal> </sw-container> {% endblock %}`,{Component:pe,Mixin:he}=Shopware;pe.register("klarna-payment-authorization",{template:ue,props:{klarnaOrder:{type:Object,required:!0}},inject:["KlarnaPaymentOrderService"],mixins:[he.getByName("notification")],computed:{buttonDisabled(){return Date.parse(this.klarnaOrder.expiry_date)<new Date("now")||this.klarnaOrder.remaining_amount<=0||this.klarnaOrder.order_status==="CANCELLED"},dateFilter(){return Shopware.Filter.getByName("date")}},data(){return{showModal:!1,isDisabled:!1,isLoading:!1,isSuccessful:!1}},methods:{extendAuthorization(){this.$emit("subComponentLoading",!0),this.isLoading=!0,this.isDisabled=!0,this.KlarnaPaymentOrderService.extendAuthorization(this.klarnaOrder.swOrderId,this.klarnaOrder.order_id).then(()=>{this.createNotificationSuccess({title:this.$tc("klarna-payment-order-management.messages.authorizationModal.extendSuccessTitle"),message:this.$tc("klarna-payment-order-management.messages.authorizationModal.extendSuccessMessage")}),this.isSuccessful=!0}).catch(()=>{this.createNotificationError({title:this.$tc("klarna-payment-order-management.messages.authorizationModal.extendErrorTitle"),message:this.$tc("klarna-payment-order-management.messages.authorizationModal.extendErrorMessage")}),this.isSuccessful=!1}).finally(()=>{this.$emit("subComponentLoading",!1),this.$emit("reload",!0),this.isLoading=!1,this.showModal=!1,this.isDisabled=!1})},openModal(){this.showModal=!0,this.isSuccessful=!1},closeModal(){this.showModal=!1}}});const ge=`{% block klarna_payment_order_cancel %} <div class="klarna-cancellation"> <sw-container v-tooltip="{message: $tc('klarna-payment-order-management.tooltips.cancellationImpossible'), disabled: !isDisabled}" :key="isDisabled"> <mt-button class='cncl-btn' :disabled="isDisabled" @click="showModal" size='default' variant="secondary"> {{ $tc('klarna-payment-order-management.cancellation.modalButton') }} </mt-button> </sw-container> <sw-modal class="klarna-cancellation--modal" v-if="isModalShown" @modal-close="closeModal" :title="$tc('klarna-payment-order-management.cancellation.modal.title')"> <div class="klarna-cancellation-modal--text"> {{ $tc('klarna-payment-order-management.cancellation.modal.content') }} </div> <template #modal-footer> <mt-button :disabled="isLoading" @click="closeModal" variant="secondary" size="default"> {{ $tc('klarna-payment-order-management.cancellation.modal.close') }} </mt-button> <sw-button-process class="klarna-cancellation-modal--action" :is-loading="isLoading" :process-success="isSuccessful" :disabled="isDisabled" variant="primary" @click="cancelPayment"> {{ $tc('klarna-payment-order-management.cancellation.modal.submit') }} </sw-button-process> </template> </sw-modal> </div> {% endblock %}`,{Component:fe,Mixin:ye}=Shopware;fe.register("klarna-order-cancel",{template:ge,props:{klarnaOrder:{type:Object,required:!0}},data(){return{isLoading:!1,isSuccessful:!1,isModalShown:!1}},computed:{isDisabled(){return!(this.klarnaOrder.captured_amount===0&&this.klarnaOrder.order_status!=="CANCELLED")}},mixins:[ye.getByName("notification")],inject:["KlarnaPaymentOrderService"],methods:{showModal(){this.isModalShown=!0,this.isSuccess=!1},closeModal(){this.isModalShown=!1},cancelPayment(){this.$emit("subComponentLoading",!0),this.isDisabled=!0,this.isLoading=!0,this.KlarnaPaymentOrderService.cancelPayment(this.klarnaOrder.orderTransactionId,this.klarnaOrder.swOrderId,this.klarnaOrder.order_id,this.klarnaOrder.salesChannel).then(()=>{this.createNotificationSuccess({title:this.$tc("klarna-payment-order-management.cancellation.messages.successTitle"),message:this.$tc("klarna-payment-order-management.cancellation.messages.successMessage")}),this.isSuccessful=!0}).catch(()=>{this.createNotificationError({title:this.$tc("klarna-payment-order-management.cancellation.messages.failureTitle"),message:this.$tc("klarna-payment-order-management.cancellation.messages.failureMessage")}),this.isSuccessful=!1}).finally(()=>{this.$emit("reload"),this.$emit("subComponentLoading",!1),this.isLoading=!1,this.isModalShown=!1})}}});const ke=`{% block klarna_payment_payment_details %} <div class="klarna-refund-button"> <sw-container v-tooltip="{message: $tc('klarna-payment-order-management.tooltips.refundImpossible'), disabled: buttonEnabled}" :key="buttonEnabled"> <mt-button class='rfnd-btn' :disabled="!buttonEnabled" @click="openRefundModal" size='default' variant="secondary"> {{ $tc('klarna-payment-order-management.buttons.refundAmount') }} </mt-button> </sw-container> <sw-modal v-if="showRefundModal" @modal-close="closeRefundModal" :title="$tc('klarna-payment-order-management.refundModal.title')" class="klarna-payment-detail--refund-modal"> <klarna-order-items :klarna-order="klarnaOrder" :return-data="returnData" :swag-commercial-installed="swagCommercialInstalled" :is-return-data-loading="isReturnDataLoading" mode="refund" v-on:select-item="onSelectItem" v-on:change-quantity="onChangeQuantity"> </klarna-order-items> <div class="klarna-payment-detail--refund-modal--content"> <sw-container columns="1fr 1fr" gap="0 32px"> <mt-text-field :disabled="true" :label="$tc('klarna-payment-order-management.refundModal.orderAmount')" :model-value="currencyFilter(klarnaOrder.order_amount, klarnaOrder.currency.isoCode)"></mt-text-field> <mt-text-field :disabled="true" :label="$tc('klarna-payment-order-management.refundModal.refundedAmount')" :model-value="currencyFilter(klarnaOrder.refunded_amount, klarnaOrder.currency.isoCode)"></mt-text-field> <mt-text-field :disabled="true" :label="$tc('klarna-payment-order-management.refundModal.remainingAmount')" :model-value="currencyFilter(klarnaOrder.remainingAmount, klarnaOrder.currency.isoCode)"></mt-text-field> <mt-number-field required="required" number-type="float" :digits="2" :label="$tc('klarna-payment-order-management.refundModal.refundAmount')" v-model="refundAmount" :min="minRefundValue" :max="maxRefundAmount"></mt-number-field> </sw-container> <mt-textarea :help-text="$tc('klarna-payment-order-management.refundModal.descriptionHelpText')" @update:model-value="onChangeDescription" :label="$tc('klarna-payment-order-management.refundModal.labelComment')" v-model="description" /> </div> <template #modal-footer> <mt-button :disabled="isLoading" @click="closeRefundModal" variant="secondary" size="default"> {{ $tc('klarna-payment-order-management.refundModal.close') }} </mt-button> <sw-button-process :is-loading="isLoading" :process-success="isRefundSuccessful" @update:process-success="onRefundFinished()" :disabled="isLoading" variant="primary" @click="refundOrder"> {{ $tc('klarna-payment-order-management.refundModal.submit') }} </sw-button-process> </template> </sw-modal> </div> {% endblock %}`,{Component:be,Mixin:we,Context:ve}=Shopware,{Criteria:S}=Shopware.Data;be.register("klarna-refund-button",{template:ke,mixins:[we.getByName("notification")],inject:["KlarnaPaymentOrderService","repositoryFactory"],props:{klarnaOrder:{type:Object,required:!0}},data(){return{isLoading:!1,hasError:!1,showRefundModal:!1,isRefundSuccessful:!1,selection:[],refundAmount:0,description:"",returnData:{},swagCommercialInstalled:!1,isReturnDataLoading:!1}},created(){this.loadSwagCommercialReturnData()},computed:{remainingAmount(){return(this.klarnaOrder.captured_amount-this.klarnaOrder.refunded_amount).toFixed(2)},buttonEnabled(){return!(this.remainingAmount<=0||this.klarnaOrder.order_status==="CANCELLED"||this.klarnaOrder.captured_amount<=0)},maxRefundAmount(){return this.remainingAmount},minRefundValue(){return .01},currencyFilter(){return Shopware.Filter.getByName("currency")}},methods:{loadSwagCommercialReturnData(){try{const e=this,t=this.repositoryFactory.create("order_return"),a=new S;a.addFilter(S.equals("orderId",this.$route.params.id)),a.addAssociation("lineItems"),a.addAssociation("lineItems.state"),a.addAssociation("lineItems.lineItem.product");let n;this.isReturnDataLoading=!0,t.search(a,ve.api).then(r=>{r.forEach(i=>{i.lineItems.forEach(s=>{n=s.lineItem.product.productNumber,e.returnData[n]||(e.returnData[n]={}),e.returnData[n][i.returnNumber]||(e.returnData[n][i.returnNumber]=s)})}),e.isReturnDataLoading=!1}),e.swagCommercialInstalled=!0}catch{}},openRefundModal(){this.showRefundModal=!0,this.isRefundSuccessful=!1,this.refundAmount=this.remainingAmount,this.description="",this.selection=[]},calculateRefundAmount(){let e=0;this.selection.forEach(t=>{t.selected&&(e+=t.unit_price/100*t.quantity)}),(e===0||e>this.remainingAmount)&&(e=this.remainingAmount),e=+e,e=e.toFixed(2),this.refundAmount=e},closeRefundModal(){this.showRefundModal=!1},onRefundFinished(){this.isRefundSuccessful=!1},refundOrder(){this.isLoading=!0;const e=[];this.selection.forEach(a=>{this.klarnaOrder.order_lines.forEach(n=>{if(n.reference===a.reference&&a.selected&&a.quantity>0){const r={...n};r.quantity=a.quantity,r.total_amount=r.unit_price*r.quantity;const i=r.tax_rate/100;r.total_tax_amount=Math.round(r.total_amount/(100+i)*i),e.push(r)}})});const t={orderTransactionId:this.klarnaOrder.orderTransactionId,order_id:this.klarnaOrder.swOrderId,klarna_order_id:this.klarnaOrder.order_id,salesChannel:this.klarnaOrder.salesChannel,refundAmount:this.refundAmount,description:this.description,orderLines:JSON.stringify(e),complete:this.refundAmount===this.maxRefundAmount};this.KlarnaPaymentOrderService.refundOrder(t).then(()=>{this.createNotificationSuccess({title:this.$tc("klarna-payment-order-management.messages.refundSuccessTitle"),message:this.$tc("klarna-payment-order-management.messages.refundSuccessMessage")}),this.isRefundSuccessful=!0}).catch(()=>{this.createNotificationError({title:this.$tc("klarna-payment-order-management.messages.refundErrorTitle"),message:this.$tc("klarna-payment-order-management.messages.refundErrorMessage")}),this.isRefundSuccessful=!1}).finally(()=>{this.$emit("reload"),this.isLoading=!1,this.showRefundModal=!1})},onSelectItem(e,t){this.selection.length===0&&this._populateSelectionProperty(),this.selection.forEach(a=>{a.reference===e&&(a.selected=t)}),this.calculateRefundAmount()},onChangeQuantity(e,t){this.selection.length===0&&this._populateSelectionProperty(),this.selection.forEach(a=>{a.reference===e&&(a.quantity=t)}),this.calculateRefundAmount()},onChangeDescription(e){e.length>=255?this.description=e.substr(0,255):this.description=e},_populateSelectionProperty(){this.klarnaOrder.order_lines.forEach(e=>{let t=e.quantity;e.captured_quantity>0&&(t=e.captured_quantity),this.selection.push({quantity:t-e.refunded_quantity,reference:e.reference,unit_price:e.unit_price,selected:!1})})}}});const Ce=`{% block klarna_payment_amount_authorization %} <sw-container class="klarna-release-amount"> <mt-text-field :help-text="$tc('klarna-payment-order-management.order-details.remainingAmountHelpText')" :suffix="true" :disabled="true" :label="$tc('klarna-payment-order-management.order-details.remainingAmount')" :model-value="currencyFilter(klarnaOrder.remaining_amount, klarnaOrder.currency.isoCode)"> <template #suffix> <sw-container v-tooltip="{message: $tc('klarna-payment-order-management.tooltips.releaseAmountImpossible'), disabled: !buttonDisabled}" :key="buttonDisabled"> <mt-button :disabled="buttonDisabled" @click="openModal" variant="secondary"> {{ $tc('klarna-payment-order-management.buttons.releaseAmount') }} </mt-button> </sw-container> </template> </mt-text-field> <sw-modal class="klarna-release-amount--modal" v-if="isModalShown" @modal-close="closeModal" :title="$tc('klarna-payment-order-management.release.modal.title')"> <div class="klarna-release-amount-modal--content"> {{ $tc('klarna-payment-order-management.release.modal.content') }} </div> <template #modal-footer> <mt-button :disabled="isLoading" @click="closeModal" variant='secondary'> {{ $tc('klarna-payment-order-management.release.modal.close') }} </mt-button> <sw-button-process class="klarna-release-amount-modal--action" :disable="isDisabled" :is-loading="isLoading" :process-success="isSuccessful" variant="primary" @click="releaseRemainingAuthorization"> {{ $tc('klarna-payment-order-management.release.modal.submit') }} </sw-button-process> </template> </sw-modal> </sw-container> {% endblock %}`,{Component:Se,Mixin:$e}=Shopware;Se.register("klarna-release-amount",{template:Ce,props:{klarnaOrder:{type:Object,required:!0}},data(){return{isLoading:!1,isDisabled:!1,isSuccessful:!1,isModalShown:!1}},mixins:[$e.getByName("notification")],inject:["KlarnaPaymentOrderService"],computed:{buttonDisabled(){return this.klarnaOrder.order_status==="CANCELLED"||this.klarnaOrder.remaining_amount<=0?!0:this.klarnaOrder.captured_amount<=0},currencyFilter(){return Shopware.Filter.getByName("currency")}},methods:{releaseRemainingAuthorization(){this.$emit("subComponentLoading",!0),this.isDisabled=!0,this.isLoading=!0,this.KlarnaPaymentOrderService.releaseRemainingAuthorization(this.klarnaOrder.swOrderId,this.klarnaOrder.order_id,this.klarnaOrder.salesChannel).then(()=>{this.createNotificationSuccess({title:this.$tc("klarna-payment-order-management.release.messages.successTitle"),message:this.$tc("klarna-payment-order-management.release.messages.successMessage")}),this.isSuccessful=!0}).catch(()=>{this.createNotificationError({title:this.$tc("klarna-payment-order-management.release.messages.errorTitle"),message:this.$tc("klarna-payment-order-management.release.messages.errorMessage")}),this.isSuccessful=!1}).finally(()=>{this.$emit("reload"),this.$emit("subComponentLoading",!1),this.isLoading=!1,this.isModalShown=!1,this.isDisabled=!1})},openModal(){this.isModalShown=!0},closeModal(){this.isModalShown=!1}}});const _e=`{% block klarna_payment_payment_details_transaction_history %} <mt-card class="klarna-payment-transactionHistory" :title="$tc('klarna-payment-order-management.transactionHistory.title')"> {% block klarna_payment_payment_details_transaction_history_data %} <sw-data-grid :data-source="translatedHistory" :columns="transactionHistoryColumns" :show-actions="true" :show-selection="false"> {% block klarna_payment_payment_details_transaction_history_data_inner %} {% block klarna_payment_payment_details_transaction_history_data_status %} <template #column-status="{ item }"> <sw-data-grid-column-boolean :value="!item.error" :is-inline-edit="false" /> </template> {% endblock %} {% block klarna_payment_payment_details_transaction_history_data_date %} <template #column-date="{ item }"> {{ dateFilter(item.date, { hour: '2-digit', minute: '2-digit' }) }} </template> {% endblock %} <template #action-modals="{ item }"> {% block klarna_payment_payment_details_transaction_history_modal_button %} <mt-button size="small" @click="openDetailModal(item)" variant='secondary'> {{ $tc('klarna-payment-order-management.buttons.showDetails') }} </mt-button> {% endblock %} </template> {% endblock %} </sw-data-grid> {% endblock %} {% block klarna_payment_payment_details_transaction_history_modal %} <sw-modal v-if="showDetailModal" @modal-close="closeDetailModal" :title="detailModalTitle" class="klarna-payment-detail--transaction-modal klarna-request--modal"> {% block klarna_payment_payment_details_transaction_history_modal_success %} <div v-if="success" class="klarna-request klarna-request--success"> <div v-if="orderAmount" class="klarna-request--amount"> <sw-data-grid :data-source="orderAmount" :columns="detailHistoryAmountColumns" :show-actions="false" :show-selection="false"> <template #column-type="{ item }"> {{ $tc('klarna-payment-order-management.transactionHistory.modal.type.' + item.type) }} </template> <template #column-value="{ item }"> {{ currencyFilter(item.value, klarnaOrder.currency.isoCode) }} </template> </sw-data-grid> </div> <div v-else> {{ $tc('klarna-payment-order-management.transactionHistory.modal.noAmount') }} </div> </div> {% endblock %} {% block klarna_payment_payment_details_transaction_history_modal_error %} <div v-else class="klarna-request--failure"> <div v-if="orderAmount" class="klarna-request--amount"> <sw-data-grid :data-source="orderAmount" :columns="detailHistoryAmountColumns" :show-actions="false" :show-selection="false"> <template #column-type="{ item }"> {{ $tc('klarna-payment-order-management.transactionHistory.modal.type.' + item.type) }} </template> <template #column-value="{ item }"> {{ item.value|currency(klarnaOrder.currency) }} </template> </sw-data-grid> </div> <div v-else> {{ $tc('klarna-payment-order-management.transactionHistory.modal.noAmount') }} </div> <div class="klarna-request-failure--order-id"> <span class="text-strong"> {{ $tc('klarna-payment-order-management.transactionHistory.modal.klarnaOrderId') }} </span> {{ klarnaOrder.order_id }} </div> <div class="klarna-request-failure--error-code"> <span class="text-strong">{{ $tc('klarna-payment-order-management.transactionHistory.modal.klarnaErrorCode') }}</span>{{ modalResponse.error_code }} </div> <div class="klarna-request-failure--http-status"> <span class="text-strong">{{ $tc('klarna-payment-order-management.transactionHistory.modal.httpStatus') }}</span>{{ modalHttpStatus }} </div> <div class="klarna-request-failure--error-messages"> <span class="text-strong">{{ $tc('klarna-payment-order-management.transactionHistory.modal.klarnaErrorMessages') }}</span> <ul> <li v-for="error_message in modalResponse.error_messages" class="messages-text"> <span>{{ error_message }}</span> </li> </ul> </div> <div class="klarna-request-failure--correlation-id"> <span class="text-strong">{{ $tc('klarna-payment-order-management.transactionHistory.modal.klarnaCorrelationId') }}</span>{{ modalResponse.correlation_id }} </div> </div> {% endblock %} {% block klarna_payment_payment_details_transaction_history_request %} <div class="klarna-request--json"> <mt-button v-if="stringRequest" size="small" @click="toggleRequestVisibility" variant='secondary'> <template v-if="isRequestShown"> {{ $tc('klarna-payment-order-management.transactionHistory.modal.RequestButton.Shown') }} </template> <template v-else> {{ $tc('klarna-payment-order-management.transactionHistory.modal.RequestButton.NotShown') }} </template> </mt-button> <mt-button v-if="stringResponse" size="small" @click="toggleResponseVisibility" variant='secondary'> <template v-if="isResponseShown"> {{ $tc('klarna-payment-order-management.transactionHistory.modal.ResponseButton.Shown') }} </template> <template v-else> {{ $tc('klarna-payment-order-management.transactionHistory.modal.ResponseButton.NotShown') }} </template> </mt-button> <sw-code-editor v-if="isRequestShown" v-model:value="stringRequest" mode="text" :editor-config="editorConfig" :soft-wraps="true" :set-focus="false" /> <sw-code-editor v-if="isResponseShown" v-model:value="stringResponse" mode="text" :editor-config="editorConfig" :soft-wraps="true" :set-focus="false" /> </div> {% endblock %} </sw-modal> {% endblock %} </mt-card> {% endblock %}`,{Component:Ae,Mixin:Me}=Shopware;Ae.register("klarna-transaction-history",{template:_e,props:{klarnaHistory:{type:Array,required:!0},klarnaOrder:{type:Object,required:!0}},data(){return{isLoading:!0,hasError:!1,showDetailModal:!1,modalRequest:{},modalResponse:{},modalHttpStatus:null,isResponseShown:!1,isRequestShown:!1,stringResponse:"",stringRequest:"",translatedHistory:[]}},watch:{modalRequest:{deep:!0,immediate:!0,handler(){this.modalRequest!==null&&(this.orderAmount=[{type:"total",value:this.klarnaOrder.order_amount}],this.modalRequest.captured_amount&&this.orderAmount.push({type:"captured",value:this.modalRequest.captured_amount/100}),this.modalRequest.refunded_amount&&this.orderAmount.push({type:"refunded",value:this.modalRequest.refunded_amount/100}))}},klarnaHistory:{deep:!0,immediate:!0,handler(){const e="klarna-payment-order-management.transactionHistory.messages.";this.translatedHistory=[],this.klarnaHistory.forEach(t=>{const a=e+t.message,n=this.$tc(a),r=Object.assign({},t);n===a?r.message=`${this.$tc(`${e}Fallback`)} (${t.message})`:r.message=n,this.translatedHistory.push(r)})}}},inject:["KlarnaPaymentOrderService"],mixins:[Me.getByName("notification")],computed:{editorConfig(){return{readOnly:!0}},transactionHistoryColumns(){return[{property:"status",label:this.$tc("klarna-payment-order-management.transactionHistory.columns.status"),rawData:!0},{property:"date",label:this.$tc("klarna-payment-order-management.transactionHistory.columns.date"),rawData:!0},{property:"message",label:this.$tc("klarna-payment-order-management.transactionHistory.columns.message"),rawData:!0}]},detailHistoryAmountColumns(){return[{property:"type",label:this.$tc("klarna-payment-order-management.transactionHistory.modal.typeColumn"),rawData:"true"},{property:"value",label:this.$tc("klarna-payment-order-management.transactionHistory.modal.valueColumn"),rawData:"true"}]},currencyFilter(){return Shopware.Filter.getByName("currency")},dateFilter(){return Shopware.Filter.getByName("date")}},methods:{openDetailModal(e){const t=JSON.parse(e.response),a=JSON.parse(e.request);this.showDetailModal=!0,this.success=!e.error,this.detailModalTitle=`${this.$tc("klarna-payment-order-management.detailModal.title")} - ${e.message}`,this.modalRequest=a,this.modalResponse=t,this.modalHttpStatus=e.statusCode?e.statusCode:null,Object.keys(t).length!==0&&t.constructor===Object&&(this.stringResponse=JSON.stringify(t,null,2).trimLeft()),Object.keys(a).length!==0&&a.constructor===Object&&(this.stringRequest=JSON.stringify(a,null,2).trimLeft())},closeDetailModal(){this.showDetailModal=!1,this.modalRequest=null,this.modalResponse=null,this.stringResponse="",this.stringRequest="",this.isRequestShown=!1,this.isResponseShown=!1},toggleResponseVisibility(){this.isResponseShown=!this.isResponseShown,this.isRequestShown=!1},toggleRequestVisibility(){this.isRequestShown=!this.isRequestShown,this.isResponseShown=!1}}});const xe={"klarna-payment-order-management":{"order-details":{title:"Bestelldetails",orderNumber:"Shopware Bestellnummer",orderAmount:"Gesamtbetrag",capturedAmount:"Erfasster Betrag",refundedAmount:"Erstatteter Betrag",remainingAmount:"Verbleibender autorisierter Betrag",remainingAmountHelpText:"Der verbleibende autorisierte Betrag kann bei Bedarf erfasst werden.",klarnaOrderId:"Klarna Order-ID",klarnaReference:"Klarna Referenz",klarnaStatus:"Klarna Auftragsstatus",initialPaymentMethod:"Ursprüngliche Zahlart",riskCheck:"Klarna Betrugsstatus",riskCheckHelpText:"Nur Transaktionen im Status ACCEPTED können erfasst werden.",expiryDate:"Läuft ab am",expiryDateHelpText:"Wird das Ablaufdatum überschritten, ist keine weitere Aktion auf der Transaktion möglich."},"order-tab":{title:"Klarna."},modal:{columns:{reference:"Produktnummer",product:"Artikel",amount:"Menge",price:"Preis",returnStatus:"Retourenstatus"}},tooltips:{transactionCancelled:"Die Transaktion wurde abgebrochen.",captureImpossible:"Eine Erfassung kann nur durchgeführt werden, wenn die Risikoprüfung erfolgreich war und ein autorisierter Betrag verfügbar ist.",refundImpossible:"Eine Rückerstattung kann nur durchgeführt werden, wenn ein Betrag vorher erfasst wurde.",extendAuthorizationImpossible:"Die Autorisierung ist bereits abgelaufen oder erfasst und kann deshalb nicht verlängert werden.",releaseAmountImpossible:"Es ist kein autorisierter Betrag mehr vorhanden oder bereits der gesamte Betrag erfasst.",cancellationImpossible:"Die Zahlung kann nur storniert werden, solange noch kein Betrag erfasst wurde."},captureModal:{title:"Betrag erfassen",submit:"Betrag erfassen",close:"Abbrechen",labelComment:"Kommentar",orderAmount:"Gesamter autorisierter Betrag",capturedAmount:"Schon erfasster Betrag",remainingAmount:"Verbleibender autorisierter Betrag",captureAmount:"Betrag erfassen",descriptionHelpText:"Der Kommentar ist aktuell nicht im Klarna Merchant Portal sichtbar."},refundModal:{title:"Betrag rückerstatten",submit:"Betrag rückerstatten",close:"Abbrechen",labelComment:"Kommentar",orderAmount:"Gesamter autorisierter Betrag",refundedAmount:"Schon rückerstatter Betrag",remainingAmount:"Verbleibender autorisierter Betrag",refundAmount:"Betrag rückerstatten",descriptionHelpText:"Der Kommentar ist aktuell nicht im Klarna Merchant Portal sichtbar.",noReturnRequested:"Keine Rückgabe beantragt"},detailModal:{title:"Details"},authorizationModal:{title:"Autorisierung verlängern",content:"Möchten Sie wirklich die Autorisierung verlängern?",submit:"Ja, verlängern",close:"Abbrechen"},transactionHistory:{title:"Bestellhistorie",columns:{status:"Status",date:"Zeitpunkt",message:"Meldung"},messages:{CancelOrder:"Bestellung storniert",CancelPayment:"Zahlung storniert",GetOrder:"Bestellung abgerufen",CreateCapture:"Betrag erfasst",CreateOrder:"Bestellung erstellt",CreateRefund:"Betrag erstattet",ExtendAuthorization:"Autorisierung verlängert",Fallback:"Unbekannte Abfrage",ReleaseRemainingAuthorization:"Restbetrag freigegeben",UpdateAddress:"Adresse geändert",UpdateOrder:"Bestellung geändert",UpdateMerchantReferences:"Händler Referenz geändert"},modal:{typeColumn:"Betrag",valueColumn:"Wert",noAmount:"Keine weiteren Informationen",httpStatus:"HTTP-Statuscode:",type:{total:"Gesamtbetrag der Transaktion",captured:"Erfasster Betrag in dieser Aktion",refunded:"Erstatteter Betrag in dieser Aktion"},klarnaOrderId:"Klarna Bestell Id:",klarnaErrorCode:"Klarna Fehler Code:",klarnaErrorMessages:"Klarna Fehler Meldungen:",klarnaCorrelationId:"Klarna Korrelations Id:",ResponseButton:{Shown:"Response verstecken",NotShown:"Response anzeigen"},RequestButton:{Shown:"Request verstecken",NotShown:"Request anzeigen"}}},cancellation:{messages:{successTitle:"Erfolg",successMessage:"Die Zahlung wurde erfolgreich storniert.",failureTitle:"Fehler",failureMessage:"Die Zahlung konnte nicht storniert werden."},modalButton:"Zahlung stornieren",modal:{title:"Zahlungsstornierung",content:"Wollen Sie die Zahlung wirklich stornieren?",submit:"Ja, stornieren",close:"Abbrechen"}},buttons:{captureAmount:"Betrag erfassen",refundAmount:"Betrag rückerstatten",cancelOrder:"Bestellung stornieren",extendAuthorization:"Autorisierung verlängern",releaseAmount:"Betrag freigeben",showDetails:"Details"},release:{messages:{successTitle:"Erfolg",successMessage:"Der verbleibende Betrag wurde freigegeben.",failureTitle:"Fehler",failureMessage:"Der verbleibende Betrag konnte nicht freigegeben werden."},modal:{title:"Verbleibenden Autorisierungsbetrag freigeben",content:"Möchten Sie wirklich den verbleibenden Autorisierungsbetrag freigeben?",submit:"Ja, freigeben",close:"Abbrechen"}},messages:{authorizationModal:{extendSuccessTitle:"Erfolg",extendSuccessMessage:"Die Klarna Autorisierung wurde erfolgreich verlängert.",extendErrorTitle:"Fehler",extendErrorMessage:"Die Klarna Autorisierung konnte nicht erfolgreich verlängert werden."},loadErrorTitle:"Fehler",loadErrorMessage:"Die Klarna Auftragsdetails konnten nicht geladen werden.",captureErrorTitle:"Fehler",captureErrorMessage:"Erfassung konnte nicht erfolgreich durchgeführt werden.",captureSuccessTitle:"Erfolg",captureSuccessMessage:"Erfassung erfolgreich durchgeführt.",refundErrorTitle:"Fehler",refundErrorMessage:"Erstattung konnte nicht erfolgreich durchgeführt werden.",refundSuccessTitle:"Erfolg",refundSuccessMessage:"Erstattung erfolgreich durchgeführt.",updateErrorTitle:"Fehler",updateErrorMessage:"Klarna hat die Änderung der Bestellung nicht akzeptiert."}}},De={"klarna-payment-order-management":{"order-details":{title:"Order details",orderNumber:"Shopware Order Number",orderAmount:"Order Total Amount",capturedAmount:"Captured Amount",refundedAmount:"Refunded Amount",remainingAmount:"Remaining Authorized Amount",remainingAmountHelpText:"The remaining authorized amount can be captured if needed.",klarnaOrderId:"Klarna Order ID",klarnaReference:"Klarna Reference",klarnaStatus:"Klarna Order Status",initialPaymentMethod:"Initial payment method",riskCheck:"Klarna Fraud Status",riskCheckHelpText:"Only transactions with status ACCEPTED can be captured",expiryDate:"Expiry Date",expiryDateHelpText:"If the expiry date is exceeded, no further action is possible on the transaction."},"order-tab":{title:"Klarna."},modal:{columns:{reference:"Product number",product:"Product",amount:"Amount",price:"Price",returnStatus:"Return status"}},tooltips:{transactionCancelled:"The transaction was cancelled.",captureImpossible:"A capture can only be performed if the risk assessment was successful and authorized amount is available.",refundImpossible:"A refund can only be made if an amount has been captured.",extendAuthorizationImpossible:"The authorization has already expired or was captured and can therefore not be renewed.",releaseAmountImpossible:"There is no authorized amount left or the full amount has been captured.",cancellationImpossible:"The payment can only be cancelled if no amount has been captured yet."},captureModal:{title:"Capture amount",submit:"Capture amount",close:"Cancel",labelComment:"Comment",orderAmount:"Total authorized amount",capturedAmount:"Amount already captured",remainingAmount:"Remaining authorized amount",captureAmount:"Capture amount",descriptionHelpText:"The comment is currently not visible in the Klarna Merchant Portal."},refundModal:{title:"Refund amount",submit:"Refund amount",close:"Cancel",labelComment:"Comment",orderAmount:"Total authorized amount",refundedAmount:"Amount already refunded",remainingAmount:"Remaining refundable amount",refundAmount:"Refund amount",descriptionHelpText:"The comment is currently not visible in the Klarna Merchant Portal.",noReturnRequested:"No return requested"},detailModal:{title:"Details"},authorizationModal:{title:"Extend authorization",content:"Do you really want to extend the authorization?",submit:"Yes, extend",close:"Cancel"},transactionHistory:{title:"Order history",columns:{status:"Status",date:"Time",message:"Message"},messages:{CancelOrder:"Order cancelled",CancelPayment:"Cancelled payment",GetOrder:"Order requested",CreateCapture:"Capture created",CreateOrder:"Order placed",CreateRefund:"Refund created",ExtendAuthorization:"Authorization extended",Fallback:"Unknown request",ReleaseRemainingAuthorization:"Remaining amount released",UpdateAddress:"Address updated",UpdateOrder:"Order updated",UpdateMerchantReferences:"Merchant reference updated"},modal:{typeColumn:"Amount",valueColumn:"Value",noAmount:"No further information",httpStatus:"HTTP Status Code:",type:{total:"Order Transaction Total Amount",captured:"Captured Amount in this action",refunded:"Refunded Amount in this action"},klarnaOrderId:"Klarna Order Id:",klarnaErrorCode:"Klarna Error Code:",klarnaErrorMessages:"Error Messages:",klarnaCorrelationId:"Klarna Correlation Id:",ResponseButton:{Shown:"Hide response",NotShown:"Show response"},RequestButton:{Shown:"Hide request",NotShown:"Show request"}}},cancellation:{messages:{successTitle:"Success",successMessage:"The payment was successfully cancelled.",failureTitle:"Failure",failureMessage:"The payment could not be cancelled."},modalButton:"Cancel payment",modal:{title:"Payment cancellation",content:"Do you really want to cancel the payment?",submit:"Yes, cancel the payment",close:"Cancel"}},release:{messages:{successTitle:"Success",successMessage:"The remaining authorization amount was successfully released.",errorTitle:"Error",errorMessage:"The remaining authorization amount could not be released."},modal:{title:"Release authorization amount",content:"Do you really want to release the remaining authorization amount?",submit:"Yes, release",close:"Cancel"}},buttons:{captureAmount:"Capture amount",refundAmount:"Refund amount",cancelOrder:"Cancel payment",extendAuthorization:"Extend authorization",releaseAmount:"Release amount",showDetails:"Details"},messages:{authorizationModal:{extendSuccessTitle:"Success",extendSuccessMessage:"The Klarna authorization was successfully extended.",extendErrorTitle:"Error",extendErrorMessage:"The Klarna authorization could not be extended."},loadErrorTitle:"Error",loadErrorMessage:"Klarna order details could not be loaded.",captureErrorTitle:"Error",captureErrorMessage:"Capture could not be performed successfully.",captureSuccessTitle:"Success",captureSuccessMessage:"Capture successfully completed.",refundErrorTitle:"Error",refundErrorMessage:"Refund could not be performed successfully.",refundSuccessTitle:"Success",refundSuccessMessage:"Refund successfully completed.",updateErrorTitle:"Error",updateErrorMessage:"Klarna does not approve the order change."}}},{Module:Ee}=Shopware;Ee.register("klarna-payment-order-management",{type:"plugin",name:"KlarnaPayment",title:"klarna-payment-order-management.general.title",description:"klarna-payment-order-management.general.descriptionTextModule",version:"1.0.0",targetVersion:"1.0.0",snippets:{"de-DE":xe,"en-GB":De},routeMiddleware(e,t){t.name==="sw.order.detail"&&t.children.push({component:"klarna-payment-tab",name:"klarna-payment-order-management.payment.detail",isChildren:!0,meta:{parentPath:"sw.order.index"},path:"/sw/order/detail/:id/klarna/:transaction"}),e(t)}});const{Component:Oe}=Shopware;Oe.override("sw-system-config",{computed:{typesWithMapInheritanceSupport(){let e=this.$super("typesWithMapInheritanceSupport");return this.domain==="KlarnaPayment.settings"&&(e.push("single-select"),e.push("multi-select")),e}},methods:{onSalesChannelChanged(e){this.$super("onSalesChannelChanged",e),this.$emit("saleschannel-changed",this.currentSalesChannelId)},hasMapInheritanceSupport(e){const t=["klarna-disable-address-validation-field","klarna-select-salutation","klarna-select-delivery-state","klarna-select-order-state","klarna-select-payment-codes"],a=e.config?e.config.componentName:void 0;return t.includes(a)?!0:this.$super("hasMapInheritanceSupport",e)}}});const{Component:ze}=Shopware;ze.override("sw-form-field-renderer",{computed:{optionTranslations(){if(["klarna-select-salutation","klarna-select-payment-codes","klarna-select-delivery-state","klarna-select-order-state"].includes(this.componentName)){if(!this.config.hasOwnProperty("options"))return{};const e=[];let t="label";return this.config.hasOwnProperty("labelProperty")&&(t=this.config.labelProperty),this.config.options.forEach(a=>{const n=this.getTranslations("options",a,[t]),r={...a,...n};e.push(r)}),{options:e}}return this.$super("optionTranslations")}}});
//# sourceMappingURL=klarna-payment-D1nTT4IA.js.map
